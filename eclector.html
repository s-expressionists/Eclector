<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- Copyright © 2010 - 2018 Robert Strandh
Copyright © 2018 - 2023 Jan Moringen -->
<title>Eclector User&rsquo;s Manual</title>

<meta name="description" content="Eclector User&rsquo;s Manual">
<meta name="keywords" content="Eclector User&rsquo;s Manual">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="#Top" rel="start" title="Top">
<link href="#Concept-index" rel="index" title="Concept index">
<link href="#SEC_Contents" rel="contents" title="Table of Contents">
<link href="#Introduction" rel="next" title="Introduction">
<style type="text/css">
<!--
/*
 * Based on version 1.0.1 of the texinfo-css stylesheet published by
 * sirgazil (https://bitbucket.org/sirgazil/texinfo-css).
 *
 * Public domain 2016 sirgazil. All rights waived.
*/

/* NATIVE ELEMENTS */

a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
a.summary-letter-printindex {text-decoration: none}
div.center {text-align:center}
div.example {margin-left: 3.2em}
span:hover a.copiable-link {visibility: visible}
strong.def-name {font-family: monospace; font-weight: bold; font-size: larger}
td.printindex-index-entry {vertical-align: top}
td.printindex-index-section {vertical-align: top; padding-left: 1em}
th.entries-header-printindex {text-align:left}
th.sections-header-printindex {text-align:left; padding-left: 1em}
ul.mark-bullet {list-style-type: disc}
ul.toc-numbered-mark {list-style: none}
a:link,
a:visited {
    color: #1E90FF;
    text-decoration: none;
}

a:active,
a:focus,
a:hover {
    text-decoration: underline;
}

abbr,
acronym {
    cursor: help;
}

blockquote {
    color: #555753;
    font-style: oblique;
    margin: 30px 0px;
    padding-left: 3em;
}

body {
    background-color: white;
    box-shadow: 0 0 2px gray;
    box-sizing: border-box;
    color: #333;
    font-family: sans-serif;
    font-size: 16px;
    margin: 50px auto;
    max-width: 80%;
    padding: 50px;
}

code,
samp,
tt,
var {
    color: purple;
    font-size: 0.8em;
}

kbd {
    padding-left: .25em;
    padding-right: .25em;
    border: solid 1px #C2C2C2;
    border-radius: 4px;
    background-color: #F0F0F0;
    box-shadow: 1px 1px silver;
}

div.example,
div.lisp {
    margin: 0px;
}

dl {
    margin: 3em 0em;
}

dl dl {
    margin: 0em;
}

dt {
    background-color: #F5F5F5;
    padding: 0.5em;
}

h1,
h2,
h2.contents-heading,
h3,
h4 {
    padding: 20px 0px 0px 0px;
    font-weight: normal;
}

h1 {
    font-size: 2.4em;
}

h2 {
    font-size: 2.2em;
    font-weight: bold;
}

h3 {
    font-size: 1.8em;
}

h4 {
    font-size: 1.4em;
}

hr {
    background-color: silver;
    border-style: none;
    height: 1px;
    margin: 0px;
}

html {
    background-color: #F5F5F5;
}

img {
    max-width: 80%;
}

li {
    padding: 5px;
}

div.display,
div.example,
div.format,
div.lisp,
div.verbatim {
    overflow: auto;
}

div.example,
div.lisp,
div.verbatim {
    background-color: #F5F5F5;
    font-size: smaller;
    padding: 1em;

    /* border with rounded corner */
    border-color: #000;
    border-radius: 4px;
    border-style: solid;
    border-width: thin;
}

pre {
    padding: 0;
    margin: 0 0 1em 0;
}
pre:last-of-type {
    margin: 0 0 0 0;
}

table {
    border-collapse: collapse;
    margin: 40px 0px;
}

.printindex table * {
    background-color: inherit;
    border-style: none;
}

td,
th {
    border-color: silver;
    border-style: solid;
    border-width: thin;
    padding: 10px;
}

th {
    background-color: #F5F5F5;
}
/* END NATIVE ELEMENTS */



/* CLASSES */
.contents {
    margin-bottom: 4em;
}

strong.def-name {
    font-size: initial;
}

/* Restrict TOC to depth 3 */
.contents > ul ul ul ul {
    display: none;
}

.float {
    margin: 3em 0em;
}

.float .caption {
    font-size: smaller;
    text-align: center;
}

.float > img {
    display: block;
    margin: auto;
}

.footnotes-segment {
    font-size: smaller;
    margin: 5em 0em;
}

.footnote-body-heading {
    display: inline;
    font-size: small;
}

.key {
    color: purple;
    font-size: 0.8em;
}

/* END CLASSES */
.header {
    display: none;
}

.menu {
    display: none;
}

-->
</style>


</head>

<body lang="en">





<div class="top-level-extent" id="Top">
<h1 class="top" id="Eclector-User_0027s-Manual"><span>Eclector User&rsquo;s Manual<a class="copiable-link" href="#Eclector-User_0027s-Manual"> &para;</a></span></h1>

<p>This manual is for Eclector version 0.10.0.
</p>

<div class="element-contents" id="SEC_Contents">
<h2 class="contents-heading">Table of Contents</h2>

<div class="contents">

<ul class="toc-numbered-mark">
  <li><a id="toc-Introduction-1" href="#Introduction">1 Introduction</a></li>
  <li><a id="toc-External-protocols-1" href="#External-protocols">2 External protocols</a>
  <ul class="toc-numbered-mark">
    <li><a id="toc-Packages-1" href="#Packages">2.1 Packages</a>
    <ul class="toc-numbered-mark">
      <li><a id="toc-Package-for-basic-features-1" href="#Package-for-basic-features">2.1.1 Package for basic features</a></li>
      <li><a id="toc-Package-for-ordinary-reader-features-1" href="#Package-for-ordinary-reader-features">2.1.2 Package for ordinary reader features</a></li>
      <li><a id="toc-Package-for-readtable-features-1" href="#Package-for-readtable-features">2.1.3 Package for readtable features</a></li>
      <li><a id="toc-Package-for-parse-result-construction-features-1" href="#Package-for-parse-result-construction-features">2.1.4 Package for parse result construction features</a></li>
      <li><a id="toc-Package-for-CST-features-1" href="#Package-for-CST-features">2.1.5 Package for CST features</a></li>
    </ul></li>
    <li><a id="toc-Basic-features-1" href="#Basic-features">2.2 Basic features</a></li>
    <li><a id="toc-Ordinary-reader-features-1" href="#Ordinary-reader-features">2.3 Ordinary reader features</a>
    <ul class="toc-numbered-mark">
      <li><a id="toc-Common-Lisp-reader-compatible-interface-1" href="#Common-Lisp-reader-compatible-interface">2.3.1 Common Lisp reader compatible interface</a></li>
      <li><a id="toc-Reader-behavior-protocol-1" href="#Reader-behavior-protocol">2.3.2 Reader behavior protocol</a></li>
      <li><a id="toc-Reader-state-protocol-1" href="#Reader-state-protocol">2.3.3 Reader state protocol</a></li>
      <li><a id="toc-Labeled-objects-and-references-1" href="#Labeled-objects-and-references">2.3.4 Labeled objects and references</a></li>
      <li><a id="toc-S_002dexpression-creation-and-quasiquotation-1" href="#S_002dexpression-creation-and-quasiquotation">2.3.5 S-expression creation and quasiquotation</a></li>
      <li><a id="toc-Readtable-initialization-1" href="#Readtable-initialization">2.3.6 Readtable initialization</a></li>
    </ul></li>
    <li><a id="toc-Readtable-features-1" href="#Readtable-features">2.4 Readtable features</a></li>
    <li><a id="toc-Parse-result-construction-features-1" href="#Parse-result-construction-features">2.5 Parse result construction features</a></li>
    <li><a id="toc-CST-reader-features-1" href="#CST-reader-features">2.6 CST reader features</a></li>
  </ul></li>
  <li><a id="toc-Recovering-from-errors-1" href="#Recovering-from-errors">3 Recovering from errors</a>
  <ul class="toc-numbered-mark">
    <li><a id="toc-Error-recovery-features-1" href="#Error-recovery-features">3.1 Error recovery features</a></li>
    <li><a id="toc-Recoverable-errors-1" href="#Recoverable-errors">3.2 Recoverable errors</a></li>
    <li><a id="toc-Potential-problems-1" href="#Potential-problems">3.3 Potential problems</a></li>
  </ul></li>
  <li><a id="toc-Side-effects-1" href="#Side-effects">4 Side effects</a>
  <ul class="toc-numbered-mark">
    <li><a id="toc-Potential-side-effects-for-the-default-client-1" href="#Potential-side-effects-for-the-default-client">4.1 Potential side effects for the default client</a>
    <ul class="toc-numbered-mark">
      <li><a id="toc-Symbols-and-packages-_0028default-client_0029-1" href="#Symbols-and-packages-_0028default-client_0029">4.1.1 Symbols and packages (default client)</a></li>
      <li><a id="toc-Read_002dtime-evaluation-_0028default-client_0029-1" href="#Read_002dtime-evaluation-_0028default-client_0029">4.1.2 Read-time evaluation (default client)</a></li>
      <li><a id="toc-Standard-reader-macros-_0028default-client_0029-1" href="#Standard-reader-macros-_0028default-client_0029">4.1.3 Standard reader macros (default client)</a></li>
    </ul></li>
    <li><a id="toc-Potential-side-effects-for-non_002ddefault-clients-1" href="#Potential-side-effects-for-non_002ddefault-clients">4.2 Potential side effects for non-default clients</a>
    <ul class="toc-numbered-mark">
      <li><a id="toc-Symbols-and-packages-1" href="#Symbols-and-packages">4.2.1 Symbols and packages</a></li>
      <li><a id="toc-Read_002dtime-evaluation-1" href="#Read_002dtime-evaluation">4.2.2 Read-time evaluation</a></li>
      <li><a id="toc-Structure-instance-creation-1" href="#Structure-instance-creation">4.2.3 Structure instance creation</a></li>
      <li><a id="toc-Circular-structure-1" href="#Circular-structure">4.2.4 Circular structure</a></li>
      <li><a id="toc-Standard-reader-macros-1" href="#Standard-reader-macros">4.2.5 Standard reader macros</a></li>
    </ul></li>
  </ul></li>
  <li><a id="toc-Interpretation-of-unclear-parts-of-the-specification-1" href="#Interpretation-of-unclear-parts-of-the-specification">5 Interpretation of unclear parts of the specification</a>
  <ul class="toc-numbered-mark">
    <li><a id="toc-Interpretation-of-Sharpsign-C-and-Sharpsign-S-1" href="#Interpretation-of-Sharpsign-C-and-Sharpsign-S">5.1 Interpretation of Sharpsign C and Sharpsign S</a></li>
    <li><a id="toc-Interpretation-of-Backquote-and-Sharpsign-Single-Quote-1" href="#Interpretation-of-Backquote-and-Sharpsign-Single-Quote">5.2 Interpretation of Backquote and Sharpsign Single Quote</a></li>
    <li><a id="toc-Circular-objects-and-custom-reader-macros-1" href="#Circular-objects-and-custom-reader-macros">5.3 Circular objects and custom reader macros</a></li>
  </ul></li>
  <li><a id="toc-Concept-index-1" href="#Concept-index" rel="index">Concept index</a></li>
  <li><a id="toc-Function-and-macro-and-variable-and-type-index-1" href="#Function-and-macro-and-variable-and-type-index" rel="index">Function and macro and variable and type index</a></li>
  <li><a id="toc-Changelog-1" href="#Changelog">Changelog</a></li>
</ul>
</div>
</div>
<hr>
<div class="chapter-level-extent" id="Introduction">
<h2 class="chapter" id="Introduction-1"><span>1 Introduction<a class="copiable-link" href="#Introduction-1"> &para;</a></span></h2>

<a class="index-entry-id" id="index-source-tracking"></a>
<a class="index-entry-id" id="index-parse-result"></a>
<a class="index-entry-id" id="index-concrete-syntax-tree"></a>

<p>Eclector is a portable, implementation-independent version of the
Common Lisp function <code class="t">read</code>, a corresponding readtable and a
quasiquotation facility.  As opposed to existing implementation-specific
versions of <code class="t">read</code>, Eclector uses generic functions to allow clients
to customize the exact behavior, such as the interpretation of tokens.
</p>
<p>Another unusual feature of Eclector is its ability to, at the discretion
of the client, recover from many syntax errors, continue reading and
return a result that somewhat resembles what would have been returned in
case the syntax had been valid.
</p>
<p>Furthermore, Eclector can be used as a <em class="emph">source tracking</em>
reader, which is accomplished through a mode of operation that
produces <em class="emph">parse results</em> which wrap the Common Lisp expressions
in objects that can also contain information about the positions in
the source code of those expressions.  One example of such parse
results are <em class="emph">concrete syntax trees</em>
<a class="footnote" id="DOCF1" href="#FOOT1"><sup>1</sup></a>.
</p><hr>
</div>
<div class="chapter-level-extent" id="External-protocols">
<h2 class="chapter" id="External-protocols-1"><span>2 External protocols<a class="copiable-link" href="#External-protocols-1"> &para;</a></span></h2>


<hr>
<div class="section-level-extent" id="Packages">
<h3 class="section" id="Packages-1"><span>2.1 Packages<a class="copiable-link" href="#Packages-1"> &para;</a></span></h3>


<hr>
<div class="subsection-level-extent" id="Package-for-basic-features">
<h4 class="subsection" id="Package-for-basic-features-1"><span>2.1.1 Package for basic features<a class="copiable-link" href="#Package-for-basic-features-1"> &para;</a></span></h4>

<p>The package for basic features such as customizable source location
construction is named <code class="t">eclector.base</code>.  Although this package does not
shadow any symbol in the <code class="t">common-lisp</code> package, we still recommend the
use of explicit package prefixes to refer to symbols in this package.
</p>
<hr>
</div>
<div class="subsection-level-extent" id="Package-for-ordinary-reader-features">
<h4 class="subsection" id="Package-for-ordinary-reader-features-1"><span>2.1.2 Package for ordinary reader features<a class="copiable-link" href="#Package-for-ordinary-reader-features-1"> &para;</a></span></h4>

<p>The package for ordinary reader features is named
<code class="t">eclector.reader</code>.  To use features of this package, we
recommend the use of explicit package prefixes, simply because this
package shadows and exports names that are also exported from the
<code class="t">common-lisp</code> package.  Importing this package will likely
cause conflicts with the <code class="t">common-lisp</code> package otherwise.
</p>
<hr>
</div>
<div class="subsection-level-extent" id="Package-for-readtable-features">
<h4 class="subsection" id="Package-for-readtable-features-1"><span>2.1.3 Package for readtable features<a class="copiable-link" href="#Package-for-readtable-features-1"> &para;</a></span></h4>

<a class="index-entry-id" id="index-readtable"></a>

<p>The package for readtable-related features is named
<code class="t">eclector.readtable</code>.  To use features of this package, we
recommend the use of explicit package prefixes, simply because this
package shadows and exports names that are also exported from the
<code class="t">common-lisp</code> package.  Importing this package will likely
cause conflicts with the <code class="t">common-lisp</code> package otherwise.
</p>
<hr>
</div>
<div class="subsection-level-extent" id="Package-for-parse-result-construction-features">
<h4 class="subsection" id="Package-for-parse-result-construction-features-1"><span>2.1.4 Package for parse result construction features<a class="copiable-link" href="#Package-for-parse-result-construction-features-1"> &para;</a></span></h4>

<a class="index-entry-id" id="index-parse-result-1"></a>

<p>The package for features related to the creation of client-defined parse
results is named <code class="t">eclector.parse-result</code>.  To use features of this
package, we recommend the use of explicit package prefixes, simply
because this package shadows and exports names that are also exported
from the <code class="t">common-lisp</code> package.  Importing this package will likely
cause conflicts with the <code class="t">common-lisp</code> package otherwise.
</p>
<hr>
</div>
<div class="subsection-level-extent" id="Package-for-CST-features">
<h4 class="subsection" id="Package-for-CST-features-1"><span>2.1.5 Package for CST features<a class="copiable-link" href="#Package-for-CST-features-1"> &para;</a></span></h4>

<a class="index-entry-id" id="index-parse-result-2"></a>
<a class="index-entry-id" id="index-concrete-syntax-tree-1"></a>

<p>The package for features related to the creation of concrete syntax
trees is named <code class="t">eclector.concrete-syntax-tree</code>.  To use features of
this package, we recommend the use of explicit package prefixes, simply
because this package shadows and exports names that are also exported
from the <code class="t">common-lisp</code> package.  Importing this package will likely
cause conflicts with the <code class="t">common-lisp</code> package otherwise.
</p>
<hr>
</div>
</div>
<div class="section-level-extent" id="Basic-features">
<h3 class="section" id="Basic-features-1"><span>2.2 Basic features<a class="copiable-link" href="#Basic-features-1"> &para;</a></span></h3>

<a class="index-entry-id" id="index-client"></a>
<a class="index-entry-id" id="index-source-location"></a>

<p>In this section, symbols written without package marker
are in the <code class="t">eclector.base</code> package
(see <a class="pxref" href="#Package-for-basic-features">Package for basic features</a>).
</p>
<p>This package provides the mechanism that enables clients to customize
the behavior of the reader.  Furthermore this package provides a
protocol for customizing a particular aspect of the behavior, namely the
construction of source positions and source ranges.  Eclector uses
source positions and source ranges in signaled conditions and parse
results (see <a class="pxref" href="#Parse-result-construction-features">Parse result construction features</a>).
</p>
<a class="anchor" id="Class-eclector_002ebase_007cstream_002dposition_002dcondition"></a><dl class="first-deftp">
<dt class="deftp" id="index-stream_002dposition_002dcondition-_005beclector_002ebase_005d"><span class="category-def">Class: </span><span><strong class="def-name">stream-position-condition [eclector.base]</strong><a class="copiable-link" href="#index-stream_002dposition_002dcondition-_005beclector_002ebase_005d"> &para;</a></span></dt>
<dd>
<p>This condition type is the supertype of all conditions which are
signaled by Eclector functions.  An instance of this condition type
stores an approximate position in an input stream and an offset from
that position.  The condition is associated with the stream content at
the designated position and offset.  The position uses a representation
which is controlled by the respective client by adding a method on the
<code class="t">source-position</code> generic function.  The offset indicates a distance
in characters which must be added to the approximate position to produce
the exact position.
</p></dd></dl>

<a class="anchor" id="Generic_002dFunction-eclector_002ebase_007cstream_002dposition"></a><dl class="first-deffn">
<dt class="deffn" id="index-stream_002dposition-_005beclector_002ebase_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">stream-position [eclector.base]</strong> <var class="def-var-arguments">condition</var><a class="copiable-link" href="#index-stream_002dposition-_005beclector_002ebase_005d"> &para;</a></span></dt>
<dd>
<p>This generic function can be called by clients in order to obtain the
approximate position in the input stream to which <var class="var">condition</var>
pertains.  The type and interpretation of the returned object depend on
the client, namely the presence of client-specific methods on the
<code class="t">source-position</code> generic function.  The information returned by the
functions <code class="t">position-offset</code> and <code class="t">range-length</code> can be used to refine
the approximate position and compute a range in the input stream
respectively.
</p>
<p>Applicable methods exist for all conditions of type
<code class="t">stream-position-condition</code>.
</p></dd></dl>

<a class="anchor" id="Generic_002dFunction-eclector_002ebase_007cposition_002doffset"></a><dl class="first-deffn">
<dt class="deffn" id="index-position_002doffset-_005beclector_002ebase_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">position-offset [eclector.base]</strong> <var class="def-var-arguments">condition</var><a class="copiable-link" href="#index-position_002doffset-_005beclector_002ebase_005d"> &para;</a></span></dt>
<dd>
<p>This generic function is called in order to compute the exact position
(or start of a range) in the input stream to which <var class="var">condition</var>
pertains by refining the approximate position obtained by calling
<code class="t">stream-position</code>.  The returned value is an integer (possibly
negative) which indicates the offset in characters from the approximate
position to the exact position.  Since the representation of the
approximate position is chosen by the client, applying the offset to
that position in a suitable way is also the responsibility of the
client.  Assuming the object returned by <code class="t">(stream-position
<var class="var">condition</var>)</code> is suitable for arithmetic, the exact position is
<em class="math">stream-position + position-offset</em>.
</p>
<p>Applicable methods exist for all conditions of type
<code class="t">stream-position-condition</code>.
</p></dd></dl>

<a class="anchor" id="Generic_002dFunction-eclector_002ebase_007crange_002dlength"></a><dl class="first-deffn">
<dt class="deffn" id="index-range_002dlength-_005beclector_002ebase_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">range-length [eclector.base]</strong> <var class="def-var-arguments">condition</var><a class="copiable-link" href="#index-range_002dlength-_005beclector_002ebase_005d"> &para;</a></span></dt>
<dd>
<p>This generic function is called in order to compute the length of the
range in the input stream to which <var class="var">condition</var> pertains.  The
returned value is a non-negative integer which indicates the length of
the range in characters.  Therefore, assuming the object returned by
<code class="t">(stream-position <var class="var">condition</var>)</code> is suitable for arithmetic, the
range covers input the positions <em class="math">[start, start + range-length]</em>
where <em class="math">start = stream-position + position-offset</em>.
</p>
<p>Applicable methods exist for all conditions of type
<code class="t">stream-position-condition</code>.
</p></dd></dl>

<a class="anchor" id="Variable-eclector_002ebase_007c_002aclient_002a"></a><dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-_002aclient_002a-_005beclector_002ebase_005d"><span class="category-def">Variable: </span><span><strong class="def-name">*client* [eclector.base]</strong><a class="copiable-link" href="#index-_002aclient_002a-_005beclector_002ebase_005d"> &para;</a></span></dt>
<dd>
<p>This variable is used by several generic functions which are called by
<code class="t">eclector.reader:read</code>.  The default value of the variable is <code class="t">nil</code>.
Clients that want to override or extend the default behavior of some
generic function of Eclector should bind this variable to some
standard object and provide a method on that generic function,
specialized to the class of that standard object.
</p></dd></dl>

<a class="anchor" id="Generic_002dFunction-eclector_002ebase_007csource_002dposition"></a><dl class="first-deffn">
<dt class="deffn" id="index-source_002dposition-_005beclector_002ebase_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">source-position [eclector.base]</strong> <var class="def-var-arguments">client stream</var><a class="copiable-link" href="#index-source_002dposition-_005beclector_002ebase_005d"> &para;</a></span></dt>
<dd>
<p>This generic function is called in order to determine the current
position in <var class="var">stream</var>.  Eclector does not inspect or manipulate the
objects returned by this generic function beyond storing them in
signaled conditions and passing them as arguments to the
<code class="t">make-source-range</code> generic function.  A client is therefore free to
define methods on this generic function that return arbitrary objects.
</p>
<p>The default method on this generic function calls <code class="t">cl:file-position</code>.
</p></dd></dl>

<a class="anchor" id="Generic_002dFunction-eclector_002ebase_007cmake_002dsource_002drange"></a><dl class="first-deffn">
<dt class="deffn" id="index-make_002dsource_002drange-_005beclector_002ebase_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">make-source-range [eclector.base]</strong> <var class="def-var-arguments">client start end</var><a class="copiable-link" href="#index-make_002dsource_002drange-_005beclector_002ebase_005d"> &para;</a></span></dt>
<dd>
<p>This generic function is called in order to turn the source positions
<var class="var">start</var> and <var class="var">end</var> into a range representation suitable
for <var class="var">client</var>.  The returned representation designates the range
of input characters from and including the character at position
<var class="var">start</var> to but not including the character at position
<var class="var">end</var>.  The default method returns
<code class="code">(cons <var class="var">start</var> <var class="var">end</var>)</code>.
</p></dd></dl>

<hr>
</div>
<div class="section-level-extent" id="Ordinary-reader-features">
<h3 class="section" id="Ordinary-reader-features-1"><span>2.3 Ordinary reader features<a class="copiable-link" href="#Ordinary-reader-features-1"> &para;</a></span></h3>

<a class="index-entry-id" id="index-parse-result-3"></a>
<a class="index-entry-id" id="index-source-tracking-1"></a>

<p>In this section, symbols written without package marker are in the
<code class="t">eclector.reader</code> package
(see <a class="pxref" href="#Package-for-ordinary-reader-features">Package for ordinary reader features</a>)
</p>
<p>The features provided in this package fall into two categories:
</p><ul class="itemize mark-bullet">
<li>The functions <code class="t">read</code>, <code class="t">read-preserving-whitespace</code>,
<code class="t">read-from-string</code> and <code class="t">read-delimited-list</code> which, together with
standard special variables, replicate the interface of the standard
Common Lisp reader (except functions related to readtables which Eclector
provides separately, see <a class="pxref" href="#Readtable-features">Readtable features</a>).  These functions are
discussed in the section <a class="ref" href="#Common-Lisp-reader-compatible-interface">Common Lisp reader compatible interface</a>.

</li><li>The second category is comprised of the <code class="t">eclector.base:*client*</code>
special variable and a collection of protocols which allow customizing
the behavior of the reader by defining methods specialized to a
particular client on the generic functions of the protocols.
</li></ul>

<div class="float" id="fig_003aread_002dcall_002dsequence_002dordinary">
<div class="center"><img class="image" src="read-call-sequence-ordinary.png" alt="read-call-sequence-ordinary">
</div><div class="caption"><p><strong class="strong">Figure 2.1: </strong>Functions and typical function call sequences.  Solid arrows
represent calls, dashed arrows represent returns from function calls.
Labels above arrows represent arguments and return values.</p></div></div>
<p><a class="ref" href="#fig_003aread_002dcall_002dsequence_002dordinary">Figure 2.1</a> illustrates the categorization
into the Common Lisp reader compatible interface and the extensible
behavior protocol as well as typical function call patterns that arise
when the functions <code class="t">read</code>, <code class="t">read-preserving-whitespace</code>,
<code class="t">read-from-string</code> and <code class="t">read-delimited-list</code> are called by client
code.
</p>

<hr>
<div class="subsection-level-extent" id="Common-Lisp-reader-compatible-interface">
<h4 class="subsection" id="Common-Lisp-reader-compatible-interface-1"><span>2.3.1 Common Lisp reader compatible interface<a class="copiable-link" href="#Common-Lisp-reader-compatible-interface-1"> &para;</a></span></h4>

<p>The following functions are like their standarad Common Lisp
counterparts with the two differences that their names are symbols in
the <code class="t">eclector.reader</code> package and that their behavior can deviate from
that of the standard reader depending on the value of the
<code class="t">eclector.base:*client*</code> variable.
</p>
<a class="anchor" id="Function-eclector_002ereader_007cread"></a><dl class="first-deffn">
<dt class="deffn" id="index-read-_005beclector_002ereader_005d"><span class="category-def">Function: </span><span><strong class="def-name">read [eclector.reader]</strong> <var class="def-var-arguments"><code class="t">&amp;optional</code> (input-stream <code class="t">*standard-input*</code>)  (eof-error-p <code class="t">t</code>)  (eof-value <code class="t">nil</code>)  (recursive-p <code class="t">nil</code>)</var><a class="copiable-link" href="#index-read-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This function is the main entry point for the ordinary reader.  It is
entirely compatible with the standard Common Lisp function with the same
name.
</p></dd></dl>

<a class="anchor" id="Function-eclector_002ereader_007cread_002dpreserving_002dwhitespace"></a><dl class="first-deffn">
<dt class="deffn" id="index-read_002dpreserving_002dwhitespace-_005beclector_002ereader_005d"><span class="category-def">Function: </span><span><strong class="def-name">read-preserving-whitespace [eclector.reader]</strong> <var class="def-var-arguments"><code class="t">&amp;optional</code> (input-stream <code class="t">*standard-input*</code>)  (eof-error-p <code class="t">t</code>)  (eof-value <code class="t">nil</code>)  (recursive-p <code class="t">nil</code>)</var><a class="copiable-link" href="#index-read_002dpreserving_002dwhitespace-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This function is entirely compatible with the standard Common Lisp
function with the same name.
</p></dd></dl>

<a class="anchor" id="Function-eclector_002ereader_007cread_002dfrom_002dstring"></a><dl class="first-deffn">
<dt class="deffn" id="index-read_002dfrom_002dstring-_005beclector_002ereader_005d"><span class="category-def">Function: </span><span><strong class="def-name">read-from-string [eclector.reader]</strong> <var class="def-var-arguments">string <code class="t">&amp;optional</code>  (eof-error-p <code class="t">t</code>)  (eof-value <code class="t">nil</code>)  <code class="t">&amp;key</code>  (start <code class="t">0</code>)  (end <code class="t">nil</code>)  (preserve-whitespace <code class="t">nil</code>)</var><a class="copiable-link" href="#index-read_002dfrom_002dstring-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This function is entirely compatible with the standard Common Lisp
function with the same name.
</p></dd></dl>

<a class="anchor" id="Function-eclector_002ereader_007cread_002ddelimited_002dlist"></a><dl class="first-deffn">
<dt class="deffn" id="index-read_002ddelimited_002dlist-_005beclector_002ereader_005d"><span class="category-def">Function: </span><span><strong class="def-name">read-delimited-list [eclector.reader]</strong> <var class="def-var-arguments">char <code class="t">&amp;optional</code>  (input-stream <code class="t">*standard-input*</code>)  (recursive-p <code class="t">nil</code>)</var><a class="copiable-link" href="#index-read_002ddelimited_002dlist-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This function is entirely compatible with the standard Common Lisp
function with the same name.
</p></dd></dl>

<hr>
</div>
<div class="subsection-level-extent" id="Reader-behavior-protocol">
<h4 class="subsection" id="Reader-behavior-protocol-1"><span>2.3.2 Reader behavior protocol<a class="copiable-link" href="#Reader-behavior-protocol-1"> &para;</a></span></h4>

<p>By defining methods on the generic functions of this protocol, clients
can customize the high-level behavior of the reader.
</p>
<div class="float" id="fig_003aread_002dcall_002dsequence_002dcustomization">
<div class="center"><img class="image" src="read-call-sequence-customization.png" alt="read-call-sequence-customization">
</div><div class="caption"><p><strong class="strong">Figure 2.2: </strong>Functions and typical function call sequences terminating on
the right hand side of the diagram at customizable generic functions
which implement aspects of the reader algorithm and standard reader
macros.  Solid arrows represent calls, dashed arrows represent returns
from function calls.  Labels above arrows represent arguments and return
values.</p></div></div>
<p><a class="ref" href="#fig_003aread_002dcall_002dsequence_002dcustomization">Figure 2.2</a> illustrates how the
customizable generic functions described in this section are called
through the client interface and the implementation of the reader
algorithm.
</p>
<a class="anchor" id="Generic_002dFunction-eclector_002ereader_007ccall_002das_002dtop_002dlevel_002dread"></a><dl class="first-deffn">
<dt class="deffn" id="index-call_002das_002dtop_002dlevel_002dread-_005beclector_002ereader_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">call-as-top-level-read [eclector.reader]</strong> <var class="def-var-arguments">client thunk input-stream  eof-error-p eof-value preserve-whitespace-p</var><a class="copiable-link" href="#index-call_002das_002dtop_002dlevel_002dread-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This generic function is called by <code class="t">read</code> if <code class="t">read</code> is called with a
false value for the <var class="var">recursive-p</var> parameter.  It calls <var class="var">thunk</var>
with the necessary context for a global <code class="t">read</code> call.  <var class="var">thunk</var>
should read and return an object without consuming any whitespace
following the object.  If <var class="var">preserve-whitespace-p</var> is false, this
function reads up to one character of whitespace after <var class="var">thunk</var>
returns.  By default, this function returns the object or
<var class="var">eof-value</var> returned by <var class="var">thunk</var> as its sole value.
</p>
<blockquote class="quotation">
<p><b class="b">Note:</b> This generic function may return more values in addition to the one
described above.  Clients may use this feature to communicate additional
information between methods (see <a class="pxref" href="#Parse-result-construction-features">Parse result construction features</a>).  Client defined methods on this generic function should
accept such additional values when calling <var class="var">thunk</var>, a next method or
<code class="t">read-common</code> and themselves return the additional values.
</p></blockquote>

<p>The default method on this generic function performs two tasks:
</p><ol class="enumerate">
<li> It establishes a context in which labels (<code class="t">#N=</code>) and references
(<code class="t">#N#</code>) work.

</li><li> It realizes the requested <var class="var">preserve-whitespace-p</var> behavior.
</li></ol>
</dd></dl>

<a class="anchor" id="Generic_002dFunction-eclector_002ereader_007cread_002dcommon"></a><dl class="first-deffn">
<dt class="deffn" id="index-read_002dcommon-_005beclector_002ereader_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">read-common [eclector.reader]</strong> <var class="def-var-arguments">client input-stream eof-error-p eof-value</var><a class="copiable-link" href="#index-read_002dcommon-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This generic function is called by <code class="t">read</code>, passing it the value of the
variable <code class="t">eclector.base:*client*</code> and the corresponding parameters.
By default, this generic function returns the objects as its sole value.
</p>
<blockquote class="quotation">
<p><b class="b">Note:</b> This generic function may return more values in addition to the one
described above.  Clients may use this feature to communicate additional
information between methods (see <a class="pxref" href="#Parse-result-construction-features">Parse result construction features</a>).  Client defined methods on this generic function should
accept such additional values when calling a next method or
<code class="t">read-maybe-nothing</code> and themselves return the additional values.
</p></blockquote>

<p>Client code can add methods on this function, specializing them to the
client class of its choice.  The actions that <code class="t">read</code> needs to take for
different values of the parameter <var class="var">recursive-p</var> have already been
taken before <code class="t">read</code> calls this generic function.
</p></dd></dl>

<a class="anchor" id="Generic_002dFunction-eclector_002ereader_007cread_002dmaybe_002dnothing"></a><dl class="first-deffn">
<dt class="deffn" id="index-read_002dmaybe_002dnothing-_005beclector_002ereader_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">read-maybe-nothing [eclector.reader]</strong> <var class="def-var-arguments">client input-stream  eof-error-p eof-value</var><a class="copiable-link" href="#index-read_002dmaybe_002dnothing-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This generic function can be called directly by the client or by the
generic function <code class="t">read-common</code> to read an object or consume input
without returning an object.  If called directly by the client, the call
has to be in the dynamic scope of a <code class="t">call-as-top-level-read</code> call.
The function <code class="t">read-maybe-nothing</code> either
</p>
<ul class="itemize mark-bullet">
<li>encounters the end of input on <var class="var">input-stream</var> and, depending on
<var class="var">eof-error-p</var> either signals an error or returns the values
<var class="var">eof-value</var> and <code class="t">:eof</code>

</li><li>or reads one or more whitespace characters an returns the values <code class="t">nil</code>
and <code class="t">:whitespace</code>

</li><li>or reads an object.  If <code class="t">*read-suppress*</code> is true, the function
returns nil and <code class="t">:suppress</code>.  Otherwise it returns the object and
<code class="t">:object</code>.

</li><li>or consumes a macro character and the characters consumed by the
associated reader macro function if that reader macro function does not
return a value.  In this case the function returns <code class="t">nil</code> and
<code class="t">:skip</code>.
</li></ul>
</dd></dl>

<blockquote class="quotation">
<p><b class="b">Note:</b> This generic function may return more values in addition to the ones
described above.  Clients may use this feature to communicate additional
information between methods (see <a class="pxref" href="#Parse-result-construction-features">Parse result construction features</a>).  Client defined methods on this generic function should
accept such additional values when calling a next method and themselves
return the additional values.
</p></blockquote>

<a class="anchor" id="Generic_002dFunction-eclector_002ereader_007cnote_002dskipped_002dinput"></a><dl class="first-deffn">
<dt class="deffn" id="index-note_002dskipped_002dinput-_005beclector_002ereader_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">note-skipped-input [eclector.reader]</strong> <var class="def-var-arguments">client input-stream reason</var><a class="copiable-link" href="#index-note_002dskipped_002dinput-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This generic function is called whenever the reader skips some input
such as a comment or a form that must be skipped because of a reader
conditional.  It is called with the value of the variable
<code class="t">eclector.base:*client*</code>, the input stream from which the input is
being read and an object indicating the reason for skipping the input.
The default method on this generic function does nothing.  Client code
can supply a method that specializes to the client class of its choice.
</p>
<p>When this function is called, the stream is positioned immediately
<em class="emph">after</em> the skipped input.  Client code that wants to know both
the beginning and the end of the skipped input must remember the
stream position before the call to <code class="t">read</code> was made as well as
the stream position when the call to this function is made.
</p></dd></dl>

<a class="anchor" id="Variable-eclector_002ereader_007c_002askip_002dreason_002a"></a><dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-_002askip_002dreason_002a-_005beclector_002ereader_005d"><span class="category-def">Variable: </span><span><strong class="def-name">*skip-reason* [eclector.reader]</strong><a class="copiable-link" href="#index-_002askip_002dreason_002a-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This variable is used by the reader to determine why a range of input
characters has been skipped.  To this end, internal functions of the
reader as well as reader macros can set this variable to a suitable
value before skipping over some input.  Then, after the input has been
skipped, the generic function <code class="t">note-skipped-input</code> is called
with the value of the variable as its <var class="var">reason</var> argument.
</p>
<p>As an example, the method on <code class="t">note-skipped-input</code> specialized to
<code class="t">eclector.parse-result:parse-result-client</code> relays the reason and
position information to the client by calling the
<code class="t">eclector.parse-result:make-skipped-input-result</code> generic function
(see <a class="pxref" href="#Parse-result-construction-features">Parse result construction features</a>).
</p></dd></dl>

<a class="anchor" id="Generic_002dFunction-eclector_002ereader_007cread_002dtoken"></a><dl class="first-deffn">
<dt class="deffn" id="index-read_002dtoken-_005beclector_002ereader_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">read-token [eclector.reader]</strong> <var class="def-var-arguments">client input-stream eof-error-p  eof-value</var><a class="copiable-link" href="#index-read_002dtoken-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This generic function is called by <code class="t">read-common</code> when it has
been detected that a token should be read.  This function is
responsible for accumulating the characters of the token and then
calling <code class="t">interpret-token</code> (see below) in order to create and
return a token.
</p></dd></dl>

<a class="anchor" id="Generic_002dFunction-eclector_002ereader_007cinterpret_002dtoken"></a><dl class="first-deffn">
<dt class="deffn" id="index-interpret_002dtoken-_005beclector_002ereader_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">interpret-token [eclector.reader]</strong> <var class="def-var-arguments">client input-stream token  escape-ranges</var><a class="copiable-link" href="#index-interpret_002dtoken-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This generic function is called by <code class="t">read-token</code> in order to
create a token from accumulated token characters.  The parameter
<var class="var">token</var> is a string containing the characters that make up the
token.  The parameter <var class="var">escape-ranges</var> indicates ranges of
characters read from <var class="var">input-stream</var> and preceded by a character
with single-escape syntax or delimited by characters with
multiple-escape syntax.  Values of <var class="var">escape-ranges</var> are lists of
elements of the form <code class="t">(<var class="var">start</var>\ .\ <var class="var">end</var>)</code> where
<code class="t"><var class="var">start</var></code> is the index of the first escaped character
and <code class="t"><var class="var">end</var></code> is the index <em class="emph">following</em> the last
escaped character.  Note that <code class="t"><var class="var">start</var></code> and
<code class="t"><var class="var">var</var></code> can be identical indicating no escaped
characters.  This can happen in cases like <code class="t">a||b</code>.  The
information conveyed by the <var class="var">escape-ranges</var> parameter is used
to convert the characters in <var class="var">token</var> according to the
<em class="emph">readtable case</em> of the current readtable before a token is
constructed.
</p></dd></dl>

<a class="anchor" id="Generic_002dFunction-eclector_002ereader_007ccheck_002dsymbol_002dtoken"></a><dl class="first-deffn">
<dt class="deffn" id="index-check_002dsymbol_002dtoken-_005beclector_002ereader_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">check-symbol-token [eclector.reader]</strong> <var class="def-var-arguments">client  input-stream token escape-ranges  position-package-marker-1 position-package-marker-2</var><a class="copiable-link" href="#index-check_002dsymbol_002dtoken-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This generic function is called by the default method on
<code class="t">interpret-token</code> when the syntax of the token corresponds to that of
a symbol.  This function checks the syntactic validity of the symbol
token and signals an error in case of a syntax error.  If there are no
syntax errors (or error recovery has been performed, see <a class="pxref" href="#Recovering-from-errors">Recovering from errors</a>), this function returns three values:
</p><ol class="enumerate">
<li> <var class="var">token</var> or a value derived from <var class="var">token</var> by error recovery
operations.

</li><li> <var class="var">position-package-marker-1</var> or a value derived from
<var class="var">position-package-marker-1</var> by error recovery operations.

</li><li> <var class="var">position-package-marker-2</var> or a value derived from
<var class="var">position-package-marker-2</var> by error recovery operations.
</li></ol>

<p>The parameter <var class="var">input-stream</var> is the input stream from which the
characters were read.  The parameter <var class="var">token</var> is a string that
contains all the characters of the token.  The parameter
<var class="var">escape-ranges</var> indicates ranges within <var class="var">token</var> that were
preceded by a character with single-escape syntax or delimited by
characters with multiple-escape syntax.  The parameter
<var class="var">position-package-marker-1</var> contains the index into <var class="var">token</var> of
the first package marker, or <code class="t">nil</code> if the token contains no package
markers.  The parameter <var class="var">position-package-marker-2</var> contains the
index into <var class="var">token</var> of the second package marker, or <code class="t">nil</code> if the
token contains no package markers or only a single package marker.
</p>
<p>The default method on this generic function checks the positions of the
package markers taking into account escape ranges.  The method signals
errors and allows error recovery as described above.
</p></dd></dl>

<a class="anchor" id="Generic_002dFunction-eclector_002ereader_007cinterpret_002dsymbol_002dtoken"></a><dl class="first-deffn">
<dt class="deffn" id="index-interpret_002dsymbol_002dtoken-_005beclector_002ereader_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">interpret-symbol-token [eclector.reader]</strong> <var class="def-var-arguments">client  input-stream token position-package-marker-1  position-package-marker-2</var><a class="copiable-link" href="#index-interpret_002dsymbol_002dtoken-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This generic function is called by the default method on
<code class="t">interpret-token</code> when the syntax of the token corresponds to
that of a valid symbol.  The parameter <var class="var">input-stream</var> is the
input stream from which the characters were read.  The parameter
<var class="var">token</var> is a string that contains all the characters of the
token.  The parameter <var class="var">position-package-marker-1</var> contains the
index into <var class="var">token</var> of the first package marker, or <code class="t">nil</code>
if the token contains no package markers.  The parameter
<var class="var">position-package-marker-2</var> contains the index into
<var class="var">token</var> of the second package marker, or <code class="t">nil</code> if the
token contains no package markers or only a single package marker.
</p>
<p>The default method on this generic function calls
<code class="t">interpret-symbol</code> (see below) with a symbol name string and a
package indicator.
</p></dd></dl>

<a class="anchor" id="Generic_002dFunction-eclector_002ereader_007cinterpret_002dsymbol"></a><dl class="first-deffn">
<dt class="deffn" id="index-interpret_002dsymbol-_005beclector_002ereader_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">interpret-symbol [eclector.reader]</strong> <var class="def-var-arguments">client input-stream  package-indicator symbol-name internp</var><a class="copiable-link" href="#index-interpret_002dsymbol-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This generic function is called by the default method on
<code class="t">interpret-symbol-token</code> as well as the default
<code class="t">#:</code> reader macro function to resolve a symbol name string and
a package indicator to a representation of the designated symbol.  The
parameter <var class="var">input-stream</var> is the input stream from which
<var class="var">package-indicator</var> and <var class="var">symbol-name</var> were read.  The
parameter <var class="var">package-indicator</var> is a either
</p>
<ul class="itemize mark-bullet">
<li>a string designating the package of that name

</li><li>the keyword <code class="t">:current</code> designating the current package

</li><li>the keyword <code class="t">:keyword</code> designating the keyword package

</li><li><code class="t">nil</code> to indicate that an uninterned symbol should be created
</li></ul>

<p>The <var class="var">symbol-name</var> is the name of the desired symbol.
</p>
<p>The default method uses <code class="t">cl:find-package</code> (or
<code class="t">cl:*package*</code> when <var class="var">package-indicator</var> is
<code class="t">:current</code>) to resolve <var class="var">package-indicator</var> followed by
<code class="t">cl:find-symbol</code> or <code class="t">cl:intern</code>, depending on
<var class="var">internp</var>, to resolve <var class="var">symbol-name</var>.
</p>
<p>A second method which is specialized on <var class="var">package-indicator</var>
being <code class="t">nil</code> uses <code class="t">cl:make-symbol</code> to create uninterned
symbols.
</p></dd></dl>

<a class="anchor" id="Generic_002dFunction-eclector_002ereader_007ccall_002dreader_002dmacro"></a><dl class="first-deffn">
<dt class="deffn" id="index-call_002dreader_002dmacro-_005beclector_002ereader_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">call-reader-macro [eclector.reader]</strong> <var class="def-var-arguments">client input-stream char  readtable</var><a class="copiable-link" href="#index-call_002dreader_002dmacro-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This generic function is called when the reader has determined that
some character is associated with a reader macro.  The parameter
<var class="var">char</var> has to be used in conjunction with the
<var class="var">readtable</var> parameter to obtain the macro function that is
associated with the macro character.  The parameter
<var class="var">input-stream</var> is the input stream from which the reader macro
function will read additional input to accomplish its task.
</p>
<p>The default method on this generic function simply obtains the reader
macro function for <var class="var">char</var> from <var class="var">readtable</var> and calls it,
passing <var class="var">input-stream</var> and <var class="var">char</var> as arguments.  The
default method therefore does the same thing that the standard
Common Lisp reader does.
</p></dd></dl>

<a class="anchor" id="Generic_002dFunction-eclector_002ereader_007cfind_002dcharacter"></a><dl class="first-deffn">
<dt class="deffn" id="index-find_002dcharacter-_005beclector_002ereader_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">find-character [eclector.reader]</strong> <var class="def-var-arguments">client designator</var><a class="copiable-link" href="#index-find_002dcharacter-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This generic function is called by the default <code class="t">#\</code> reader macro
function to find a character.  <var class="var">designator</var> is either
</p><ul class="itemize mark-bullet">
<li>a <code class="t">string</code> that is the name of the character to be found with single
and multiple escapes removed, but with the case of all characters as it
was in the input.

</li><li>or a character designating itself.
</li></ul>
<p>The function has to either return the character designated by
<var class="var">designator</var> or <code class="t">nil</code> if no such character exists.
</p>
<p>If <var class="var">designator</var> is a <code class="t">string</code>, it is the responsibility of the
client to disregard the case of characters in <var class="var">designator</var>, for
example by producing an uppercase string from <var class="var">designator</var> before
looking up the designated character.
</p>
<p>A default method on this generic function that is not specialized to any
particular client but is specialized to <var class="var">designator</var> being a
<code class="t">string</code> recognizes the mandatory character names listing in HyperSpec
Section 13.1.7 Character Names.  Another default method on this generic
function that is not specialized to any particular client but is
specialized to <var class="var">designator</var> being a <code class="t">character</code> just returns
<var class="var">designator</var>.
</p></dd></dl>

<a class="anchor" id="Generic_002dFunction-eclector_002ereader_007cmake_002dstructure_002dinstance"></a><dl class="first-deffn">
<dt class="deffn" id="index-make_002dstructure_002dinstance-_005beclector_002ereader_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">make-structure-instance [eclector.reader]</strong> <var class="def-var-arguments">client name initargs</var><a class="copiable-link" href="#index-make_002dstructure_002dinstance-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This generic function is called by the default <code class="t">#S</code> reader
macro function to construct structure instances.  <var class="var">name</var> is a
symbol naming the structure type of which an instance should be
constructed.  <var class="var">initargs</var> is a list the elements of which
alternate between string designators naming structure slots and values
for those slots.
</p>
<p>It is the responsibility of the client to coerce the string
designators to symbols as if by
<code class="code">(intern (string slot-name) (find-package 'keyword))</code>
as described in the Common Lisp specification.
</p>
<p>There is no default method on this generic function since there is no
portable way to construct structure instances given only the name of
the structure type.
</p></dd></dl>

<a class="anchor" id="Generic_002dFunction-eclector_002ereader_007ccall_002dwith_002dcurrent_002dpackage"></a><dl class="first-deffn">
<dt class="deffn" id="index-call_002dwith_002dcurrent_002dpackage-_005beclector_002ereader_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">call-with-current-package [eclector.reader]</strong> <var class="def-var-arguments">client thunk  package-designator</var><a class="copiable-link" href="#index-call_002dwith_002dcurrent_002dpackage-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<blockquote class="quotation">
<p><b class="b">Warning:</b> This generic function is deprecated as of Eclector 0.9 and will be
removed in a future version.  Please use the generic function
<code class="t">eclector.reader:call-with-state-value</code> with the aspect designator
<code class="t">'cl:*package*</code> instead (see <a class="pxref" href="#Reader-state-protocol">Reader state protocol</a> for more
information on the reader state protocol).
</p></blockquote>

<p>This generic function is called by the reader when input has to be
read with a particular current package.  This is currently only the
case in the <code class="t">#+</code> and <code class="t">#-</code> reader macro functions which
read feature expressions in the keyword package.  <var class="var">thunk</var> is a
function that should be called without arguments.
<var class="var">package-designator</var> designates the package that should be the
current package around the call to <var class="var">thunk</var>.
</p>
<p>The default method on this generic function simply binds
<code class="t">cl:*package*</code> to the result of
<code class="code">(cl:find-package <var class="var">package-designator</var>)</code>
around calling <var class="var">thunk</var>.
</p></dd></dl>

<a class="anchor" id="Generic_002dFunction-eclector_002ereader_007cevaluate_002dexpression"></a><dl class="first-deffn">
<dt class="deffn" id="index-evaluate_002dexpression-_005beclector_002ereader_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">evaluate-expression [eclector.reader]</strong> <var class="def-var-arguments">client expression</var><a class="copiable-link" href="#index-evaluate_002dexpression-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This generic function is called by the default <code class="t">#.</code> reader
macro function to perform read-time evaluation.  <var class="var">expression</var>
is the expression that should be evaluated as it was returned by a
recursive <code class="t">read</code> call and potentially influenced by
<var class="var">client</var>.  The function has to either return the result of
evaluating <var class="var">expression</var> or signal an error.
</p>
<p>The default method on this generic function simply returns the result
of <code class="code">(cl:eval <var class="var">expression</var>)</code>.
</p></dd></dl>

<a class="anchor" id="Generic_002dFunction-eclector_002ereader_007ccheck_002dfeature_002dexpression"></a><dl class="first-deffn">
<dt class="deffn" id="index-check_002dfeature_002dexpression-_005beclector_002ereader_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">check-feature-expression [eclector.reader]</strong> <var class="def-var-arguments">client  feature-expression</var><a class="copiable-link" href="#index-check_002dfeature_002dexpression-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This generic function is called by the default <code class="t">#+</code> and
<code class="t">#-</code> reader macro functions to check the well-formedness of
<var class="var">feature-expression</var> which has been read from the input stream
before evaluating it.  For compound expressions, only the outermost
expression is checked regarding the atom in operator position and its
shape &ndash; child expressions are not checked.  The function returns an
unspecified value if <var class="var">feature-expression</var> is well-formed and
signals an error otherwise.
</p>
<p>The default method on this generic function accepts standard
Common Lisp feature expression, i.e. expressions recursively
composed of symbols, <code class="t">:not</code>-expressions,
<code class="t">:and</code>-expressions and <code class="t">:or</code>-expressions.
</p></dd></dl>

<a class="anchor" id="Generic_002dFunction-eclector_002ereader_007cevaluate_002dfeature_002dexpression"></a><dl class="first-deffn">
<dt class="deffn" id="index-evaluate_002dfeature_002dexpression-_005beclector_002ereader_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">evaluate-feature-expression [eclector.reader]</strong> <var class="def-var-arguments">client feature-expression</var><a class="copiable-link" href="#index-evaluate_002dfeature_002dexpression-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This generic function is called by the default <code class="t">#+</code> and
<code class="t">#-</code> reader macro functions to evaluate
<var class="var">feature-expression</var> which has been read from the input stream.
The function returns either true or false if
<var class="var">feature-expression</var> is well-formed and signals an error
otherwise.
</p>
<p>For compound feature expressions, the well-formedness of child
expressions is not checked immediately but lazily, just before the child
expression in question is evaluated in a subsequent
<code class="t">evaluate-feature-expression</code> call.  This allows expressions like
<code class="code">#+(and my-cl-implementation (special-feature a b)) <var class="var">form</var></code> to
be read without error when the <code class="t">:my-cl-implementation</code> feature is
absent.
</p>
<p>The default method on this generic function first calls
<code class="t">check-feature-expression</code> to check the well-formedness of
<var class="var">feature-expression</var>.  It then evaluates
<var class="var">feature-expression</var> according to standard Common Lisp
semantics for feature expressions.
</p></dd></dl>

<hr>
</div>
<div class="subsection-level-extent" id="Reader-state-protocol">
<h4 class="subsection" id="Reader-state-protocol-1"><span>2.3.3 Reader state protocol<a class="copiable-link" href="#Reader-state-protocol-1"> &para;</a></span></h4>

<a class="index-entry-id" id="index-reader-state"></a>
<a class="index-entry-id" id="index-aspect_002c-reader-state"></a>

<p>The reader state protocol consists of generic functions which the reader
and the client call to query and modify the values of reader state
<em class="emph">aspects</em>.  Each aspect is named by a symbol and holds a current
value and has a stack of shadowed values like a special variable.
Aspects roughly correspond to the reader control variables defined in
the Common Lisp specification.  Eclector defines the following
aspects:
</p>
<a class="anchor" id="table_003aminimal_002dreader_002dstate_002daspects"></a><dl class="table">
<dt><code class="code">cl:*readtable*</code></dt>
<dd>
<p>Like the <code class="t">cl:*readtable*</code> special variable, this aspects controls the
readtable object in which the reader looks up the syntax types of
characters, the case conversion mode as well as reader macros.  By
default, values of this aspect must satisfy the
<code class="t">eclector.readtable:readtablep</code> predicate.
</p>
</dd>
<dt><code class="code">cl:*package*</code></dt>
<dd>
<p>Like the <code class="t">cl:*package*</code> special variable, this aspects controls the
package which the reader uses when it looks up or interns symbols in the
current package.
</p>
</dd>
<dt><code class="code">cl:*read-suppress*</code></dt>
<dd>
<p>Like the <code class="t">cl:*read-suppress*</code> special variable, this aspect controls
whether the reader skips over expressions without detailed parsing.
</p>
</dd>
<dt><code class="code">cl:*read-eval*</code></dt>
<dd>
<p>Like the <code class="t">cl:*read-eval*</code> special variable, this aspect controls
whether the reader evaluates expressions in <code class="t">#.</code> constructs.
</p>
</dd>
<dt><code class="code">cl:*features*</code></dt>
<dd>
<p>Like the <code class="t">cl:*features*</code> special variable, this aspect controls the
evaluation of features in feature expressions in <code class="t">#+</code> and <code class="t">#-</code>
constructs.
</p>
</dd>
<dt><code class="code">cl:*read-base*</code></dt>
<dd>
<p>Like the <code class="t">cl:*read-base*</code> special variable, this aspect controls the
interpretation of tokens by the reader as being integers or ratios.
</p>
</dd>
<dt><code class="code">cl:*read-default-float-format*</code></dt>
<dd>
<p>Like the <code class="t">cl:*read-default-float-format*</code> special variable, this
aspect controls the floating-point format that the reader uses for
floating-point numbers without exponent marker or the default exponent
marker.
</p>
</dd>
</dl>

<a class="anchor" id="Generic_002dFunction-eclector_002ereader_007cvalid_002dstate_002dvalue_002dp"></a><dl class="first-deffn">
<dt class="deffn" id="index-valid_002dstate_002dvalue_002dp-_005beclector_002ereader_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">valid-state-value-p [eclector.reader]</strong> <var class="def-var-arguments">client aspect value</var><a class="copiable-link" href="#index-valid_002dstate_002dvalue_002dp-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This generic function is called by the reader to determine whether
<var class="var">value</var> is a valid value for the reader state aspect designated by
<var class="var">aspect</var>.  The generic function returns true if, according to
<var class="var">client</var>, <var class="var">value</var> is a valid value for the reader state aspect
designated by <var class="var">aspect</var>.  <var class="var">aspect</var> must designate a reader state
aspect that is recognized by <var class="var">client</var>.  At least the aspects listed
in the <a class="ref" href="#table_003aminimal_002dreader_002dstate_002daspects">minimal reader state
aspects table</a> must be recognized by any client.
</p>
<p>With the exceptions of <code class="t">cl:*readtable*</code> and <code class="t">cl:*package*</code>, the
default methods on this generic function recognize state aspects and
implement type restrictions informed by the Common Lisp specification:
</p><table class="multitable">
<thead><tr><th width="30%">Aspect</th><th width="70%">Type</th></tr></thead>
<tbody><tr><td width="30%"><code class="t">cl:*readtable*</code></td><td width="70%"><code class="t">(satisfies eclector.readtable:readtablep)</code></td></tr>
<tr><td width="30%"><code class="t">cl:*package*</code></td><td width="70%"><code class="t">(or cl:package cl:symbol cl:string cl:character)</code> (package designator)</td></tr>
<tr><td width="30%"><code class="t">cl:*read-suppress*</code></td><td width="70%"><code class="t">t</code> (generalized Boolean)</td></tr>
<tr><td width="30%"><code class="t">cl:*read-eval*</code></td><td width="70%"><code class="t">t</code> (generalized Boolean)</td></tr>
<tr><td width="30%"><code class="t">cl:*features*</code></td><td width="70%"><code class="t">list</code> (proper list)</td></tr>
<tr><td width="30%"><code class="t">cl:*read-base*</code></td><td width="70%"><code class="t">(integer 2 36)</code> (radix)</td></tr>
<tr><td width="30%"><code class="t">cl:*read-default-float-format*</code></td><td width="70%"><code class="t">(member short-float single-float double-float long-float)</code></td></tr>
</tbody>
</table>
</dd></dl>

<a class="anchor" id="Generic_002dFunction-eclector_002ereader_007cstate_002dvalue"></a><dl class="first-deffn">
<dt class="deffn" id="index-state_002dvalue-_005beclector_002ereader_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">state-value [eclector.reader]</strong> <var class="def-var-arguments">client aspect</var><a class="copiable-link" href="#index-state_002dvalue-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>Return the current value of the reader state aspect designated by
<var class="var">aspect</var>.
</p>
<p><var class="var">aspect</var> must designate a reader state aspect that is recognized by
<var class="var">client</var>.  At least the aspects listed in the
<a class="ref" href="#table_003aminimal_002dreader_002dstate_002daspects">minimal reader state aspects
table</a> must be recognized by any client.
</p>
<p>The <code class="t">cl:*package*</code> aspect mandates further explanation: When the
client uses only the default methods of the reader state protocol, the
return value of this generic function for the <code class="t">cl:*package*</code> aspect is
of type <code class="t">cl:package</code> which is a strict subtype of the type of valid
values for this aspect.  In other words, the defaults coerce package
designators to package objects.
</p></dd></dl>

<a class="anchor" id="Generic_002dFunction-eclector_002ereader_007ccall_002dwith_002dstate_002dvalue"></a><dl class="first-deffn">
<dt class="deffn" id="index-call_002dwith_002dstate_002dvalue-_005beclector_002ereader_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">call-with-state-value [eclector.reader]</strong> <var class="def-var-arguments">client thunk aspect value</var><a class="copiable-link" href="#index-call_002dwith_002dstate_002dvalue-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>Call <var class="var">thunk</var> with the reader state aspect designated by <var class="var">aspect</var>
bound to <var class="var">value</var>.
</p>
<p><var class="var">aspect</var> must designate a reader state aspect that is recognized by
<var class="var">client</var>.  At least the aspects listed in the
<a class="ref" href="#table_003aminimal_002dreader_002dstate_002daspects">minimal reader state aspects
table</a> must be recognized by any client.
</p>
<p>The following properties must hold:
</p>
<ul class="itemize mark-bullet">
<li><var class="var">value</var> has to be a valid value for <var class="var">aspect</var> in the sense that
<code class="code">(eclector.reader:valid-state-value-p <var class="var">client</var> <var class="var">aspect</var>
<var class="var">value</var>)</code> must return true.

</li><li>During the call to <var class="var">thunk</var> and absent any intervening calls to
<code class="t">eclector.reader:call-with-state-value</code>, the expression
<code class="code">(eclector.reader:state-value <var class="var">client</var> <var class="var">aspect</var>)</code> must
evaluate to <var class="var">value</var>.
</li></ul>

<p>When Eclector calls this generic function with <code class="t">cl:*package*</code> as the
value of <var class="var">aspect</var>, the <var class="var">value</var> is a always a string designator
and never a package object.  The default method on this generic function
coerces such string designators to package objects so that a subsequent
<code class="t">eclector.reader:state-value</code> call returns the designated package
object.
</p></dd></dl>

<hr>
</div>
<div class="subsection-level-extent" id="Labeled-objects-and-references">
<h4 class="subsection" id="Labeled-objects-and-references-1"><span>2.3.4 Labeled objects and references<a class="copiable-link" href="#Labeled-objects-and-references-1"> &para;</a></span></h4>

<a class="index-entry-id" id="index-labeled-object"></a>

<p>Eclector includes implementations of the <code class="t">#=</code> and <code class="t">##</code> reader
macros and they are present in the default readtable.  One way to
customize the behavior of the reader around the <code class="t">#=</code> and <code class="t">##</code> syntax
is replacing the reader macro functions with custom ones but with this
approach the client code has to reimplement a lot of functionality.  As
a finer grained and more composable mechanism for customization,
Eclector provides a protocol for implementing and customizing the
behavior of the <code class="t">#=</code> and <code class="t">##</code> reader macros, with or without
modifying the readtable.  The remainder of this section describes that
protocol.
</p>
<p>To start with a bit of terminology, we call the object created by
reading <code class="t">#<var class="var">N</var>=<var class="var">expression</var></code> a <em class="dfn">labeled object</em>. We call
<var class="var">N</var> the <em class="dfn">label</em> of the labeled object and the result of reading
<code class="t"><var class="var">expression</var></code> the <em class="dfn">object</em> of the labeled object.  We say
that <code class="t">#<var class="var">N</var>=<var class="var">expression</var></code> <em class="dfn">defines</em> the labeled object and
<code class="t">#<var class="var">N</var>#</code> <em class="dfn">references</em> the labeled object.  We call the
reference <em class="dfn">circular</em> if <code class="t">#<var class="var">N</var>#</code> occurs within
<var class="var">expression</var>.  Labeled objects are internal to the reader and only
exist during <code class="t">eclector.reader:read</code> calls: before such a call returns
an object, each labeled object within the returned object is replaced by
its respective final object.  Callers of <code class="t">eclector.reader:read</code> and
related functions will therefore only ever see the object, never the
labeled object<a class="footnote" id="DOCF2" href="#FOOT2"><sup>2</sup></a>.
</p>
<p>On a technical level, a labeled object is represented as a data type
with a current state and a single (possibly unbound) slot containing the
object.  The following diagrams depicts the possible states of a labeled
object together with input patterns and corresponding transitions:
</p>
<div class="float" id="fig_003alabeled_002dobject_002dstates">
<div class="center"><img class="image" src="labeled-object-states.png" alt="labeled-object-states">
</div><div class="caption"><p><strong class="strong">Figure 2.3: </strong>Possible states of a labeled object and input patterns which
correspond to state transitions.</p></div></div>
<p>Put differently, a labeled object can be in the following states:
</p>
<table class="multitable">
<thead><tr><th width="50%">State</th><th width="30%">Object slot</th></tr></thead>
<tbody><tr><td width="50%">undefined</td><td width="30%">&ndash;</td></tr>
<tr><td width="50%">defined</td><td width="30%">unbound</td></tr>
<tr><td width="50%">final</td><td width="30%">the object</td></tr>
<tr><td width="50%">referenced <em class="emph">(not strictly needed)</em></td><td width="30%">the object</td></tr>
<tr><td width="50%">circular</td><td width="30%">unbound</td></tr>
<tr><td width="50%">final (circular)</td><td width="30%">the object</td></tr>
<tr><td width="50%">referenced (circular) <em class="emph">(not strictly needed)</em></td><td width="30%">the object</td></tr>
</tbody>
</table>

<p>The distinction between the states <code class="t">final</code> and <code class="t">referenced</code> on the
one hand and <code class="t">final (circular)</code>, and <code class="t">referenced (circular)</code> on the
other hand is not required for implementing labeled objects.  Those two
pairs of states are therefore collapsed to just <code class="t">final</code> and <code class="t">final
(circular)</code> in the remainder of this section.  The following figure and
paragraphs describe generic functions and methods which implement the
creation, registration, lookup and manipulation of labeled objects
according to the reduced set of states:
</p>
<div class="float" id="fig_003alabeled_002dobject_002dapi_002dstates">
<div class="center"><img class="image" src="labeled-object-api-states.png" alt="labeled-object-api-states">
</div><div class="caption"><p><strong class="strong">Figure 2.4: </strong>Reduced set of states of a labeled object and protocol
functions with corresponding state transitions.</p></div></div>
<p>In addition to the generic functions referenced in the above diagram,
the generic functions <code class="t">fixup-graph-p</code>, <code class="t">fixup-graph</code> and <code class="t">fixup</code>
are part of the protocol.  Those functions are used to replace labeled
objects with their respective final objects within an object that is
about to be returned to the caller of <code class="t">eclector.reader:read</code>
<a class="footnote" id="DOCF3" href="#FOOT3"><sup>3</sup></a>.  To
this end, the <code class="t">#=</code> reader macro function must inspect and update the
state of the labeled object it is processing after reading
<code class="t"><var class="var">expression</var></code> by calling <code class="t">finalize-labeled-object</code>.
<code class="t">finalize-labeled-object</code> decides whether <code class="t">fixup-graph</code> (see below)
must be called: If after reading <code class="t"><var class="var">expression</var></code> the labeled object
is in state <code class="t">:circular</code>, <code class="t"><var class="var">expression</var></code> must have contained
circular references and the result of reading it contains labeled
objects that have to be replaced with their respective final objects.
<code class="t">fixup-graph</code> and <code class="t">fixup</code> perform this replacement.  This
replacement is performed by recursively traversing objects which are
reachable from the final object of the labeled objects, for example by
visiting the slots of standard objects, and replacing labeled objects
with their respective final object.
</p>
<p>In certain cases, the computational complexity of this traversal and
replacement can be rather high, depending on when and how exactly the
traversal is performed: consider an expression of the form
<code class="t">#1=(1 #1# #2=(2 #2# &hellip;))</code>.  The nested labeled objects in this
expression are all circular and thus require fixing up.  The <code class="t">read</code>
call for the innermost labeled object, say <code class="t">#100=&hellip;</code>, returns
first and the fixup processing for the labeled object could be performed
immediately.  The problem is that each of the labeled objects would
be processed in the same manner which would lead to a computation
complexity of <em class="math">O(N M)</em> where <em class="math">N</em> is the number of labels and
<em class="math">M</em> is the number of nodes in the object graph rooted at the object
which is returned by the outermost <code class="t">read</code> call.  One way to avoid this
problem would be to perform fixup processing only for the outermost
<code class="t">read</code> call.  The problem with that approach is that only a small
sub-graph of the whole object graph may be circular in which case most
of the work for traversing the whole graph would be wasted.  To address
both problems, Eclector allows clients to track the nesting of labeled
objects and fix up sub-graphs which contain multiple nested objects in
one go
(see <a class="pxref" href="#Generic_002dFunction-eclector_002ereader_007cfixup_002dgraph_002dp">fixup-graph-p</a>).
</p>
<a class="anchor" id="Generic_002dFunction-eclector_002ereader_007ccall_002dwith_002dlabel_002dtracking"></a><dl class="first-deffn">
<dt class="deffn" id="index-call_002dwith_002dlabel_002dtracking-_005beclector_002ereader_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">call-with-label-tracking [eclector.reader]</strong> <var class="def-var-arguments">client thunk</var><a class="copiable-link" href="#index-call_002dwith_002dlabel_002dtracking-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This generic function is called by the default method on
<code class="t">call-as-top-level-read</code> in order to establish a context for tracking
<code class="t">#=</code> label definitions and <code class="t">##</code> label references around a call to
<var class="var">thunk</var>.
</p>
<p>The default method on this generic function establishes a context in
which the default <code class="t">#=</code> and <code class="t">##</code> reader macro functions can make the
appropriate calls to <code class="t">note-labeled-object</code>, <code class="t">forget-labeled-object</code>,
<code class="t">find-labeled-object</code>.
</p></dd></dl>

<a class="anchor" id="Generic_002dFunction-eclector_002ereader_007cnote_002dlabeled_002dobject"></a><dl class="first-deffn">
<dt class="deffn" id="index-note_002dlabeled_002dobject-_005beclector_002ereader_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">note-labeled-object [eclector.reader]</strong> <var class="def-var-arguments">client input-stream label  parent</var><a class="copiable-link" href="#index-note_002dlabeled_002dobject-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This generic function is called by the default <code class="t">#=</code> reader macro
function to note the definition of a labeled object with label
<var class="var">label</var> while reading from <var class="var">input-stream</var>.  The function
creates, registers and returns a representation of the labeled object.
The returned object is registered in the sense that a subsequent call to
<code class="t">find-labeled-object</code> with arguments <var class="var">client</var> and <var class="var">label</var>
returns the same object unless <code class="t">forget-labeled-object</code> has been called
to unregister the object.
</p>
<p><var class="var">parent</var> is either <code class="t">nil</code> or a (previously created) surrounding
labeled object.  The parent labeled object is provided to allow the
client to potentially defer fixup processing for the new labeled object
if the processing for the surrounding labeled object subsumes the
processing for the new labeled object.
</p>
<p>Note that, when reading an expression of the form
<code class="t">#<var class="var">N</var>=<var class="var">object</var></code>, this function is called after reading
<code class="t">#<var class="var">N</var>=</code> from <var class="var">input-stream</var> but before reading
<code class="t"><var class="var">object</var></code>.  Consequently, the created and returned labeled object
is defined but does not have an object associated with it.
</p>
<p>The default method on this generic function calls
<code class="t">make-labeled-object</code> with <var class="var">client</var>, <var class="var">input-stream</var> and
<var class="var">label</var> to create an object of an unspecified type.  The method
registers and returns the created object.  Client code should manipulate
the object only via the generic functions described in this section and
in particular not rely on the object being of a particular type (since
methods on <code class="t">make-labeled-object</code> specialized to certain client classes
could return unexpected objects).  The default method requires the
context established by the default method on
<code class="t">call-with-label-tracking</code>.
</p></dd></dl>

<a class="anchor" id="Generic_002dFunction-eclector_002ereader_007cforget_002dlabeled_002dobject"></a><dl class="first-deffn">
<dt class="deffn" id="index-forget_002dlabeled_002dobject-_005beclector_002ereader_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">forget-labeled-object [eclector.reader]</strong> <var class="def-var-arguments">client label</var><a class="copiable-link" href="#index-forget_002dlabeled_002dobject-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This generic function is called by the default <code class="t">#=</code> reader macro
function when Eclector reads an invalid labeled object of the form
<code class="t">#<var class="var">N</var>=#<var class="var">N</var>#</code> and the caller chooses to recover from the
resulting error (see <a class="pxref" href="#Recovering-from-errors">Recovering from errors</a>).  In that situation,
the remainder of the input is processed as if there had been no labeled
object with label <var class="var">N</var>.  This function makes the labeled object
undefined so that a subsequent <code class="t">find-labeled-object</code> call for
<var class="var">label</var> will return <code class="t">nil</code>.
</p>
<p>The default method on this generic function requires the context
established by the default method on <code class="t">call-with-label-tracking</code>.
</p></dd></dl>

<a class="anchor" id="Generic_002dFunction-eclector_002ereader_007cfind_002dlabeled_002dobject"></a><dl class="first-deffn">
<dt class="deffn" id="index-find_002dlabeled_002dobject-_005beclector_002ereader_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">find-labeled-object [eclector.reader]</strong> <var class="def-var-arguments">client label</var><a class="copiable-link" href="#index-find_002dlabeled_002dobject-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This generic function is called by the default <code class="t">##</code> reader macro
function to look up the previously registered representation of a
labeled object for <var class="var">label</var>.  The function returns <code class="t">nil</code> if no such
object has been registered for <var class="var">label</var> and the registered object
otherwise.
</p>
<p>The default method on this generic function requires the context
established by the default method on <code class="t">call-with-label-tracking</code>.
</p></dd></dl>

<a class="anchor" id="Generic_002dFunction-eclector_002ereader_007cmake_002dlabeled_002dobject"></a><dl class="first-deffn">
<dt class="deffn" id="index-make_002dlabeled_002dobject-_005beclector_002ereader_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">make-labeled-object [eclector.reader]</strong> <var class="def-var-arguments">client input-stream label  parent</var><a class="copiable-link" href="#index-make_002dlabeled_002dobject-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This generic function is called by <code class="t">note-labeled-object</code> to create and
return a representation of a labeled object with label <var class="var">label</var>.
<var class="var">parent</var> is either <code class="t">nil</code> or a previously created, surrounding
labeled object which allows the client to potentially defer fixup
processing for the new labeled object if the processing for the
surrounding labeled object subsumes the processing.
</p>
<p>The default method on this generic function creates and returns an
object of an unspecified type.  Client code should manipulate the object
only via the generic functions <code class="t">labeled-object-state</code>,
<code class="t">finalize-labeled-object</code> and <code class="t">reference-labeled-object</code> and in
particular not rely on the object being of a particular type (since
methods on this generic function specialized to certain client classes
could return unexpected objects).
</p></dd></dl>

<a class="anchor" id="Generic_002dFunction-eclector_002ereader_007clabeled_002dobject_002dstate"></a><dl class="first-deffn">
<dt class="deffn" id="index-labeled_002dobject_002dstate-_005beclector_002ereader_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">labeled-object-state [eclector.reader]</strong> <var class="def-var-arguments">client object</var><a class="copiable-link" href="#index-labeled_002dobject_002dstate-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This generic function is called by the default <code class="t">#=</code> reader macro
function to determine the state of <var class="var">object</var>.  This function returns
</p>
<ul class="itemize mark-bullet">
<li><code class="t">nil</code> if <var class="var">object</var> is not a labeled object

</li><li>two values if <var class="var">object</var> is a labeled object: one of the keywords
<code class="t">:defined</code>, <code class="t">:circular</code>, <code class="t">:final</code>, <code class="t">:final/circular</code> and the
final object stored in <var class="var">object</var> if the first value is either
<code class="t">:final</code> or <code class="t">:final/circular</code> or <code class="t">nil</code> otherwise.
</li></ul>

<p>The following table lists all possible return value shapes:
</p><table class="multitable">
<thead><tr><th width="30%"><var class="var">object</var> is a labeled object</th><th width="30%">First value</th><th width="30%">Second value</th></tr></thead>
<tbody><tr><td width="30%">no</td><td width="30%"><code class="t">nil</code></td><td width="30%"></td></tr>
<tr><td width="30%">yes</td><td width="30%"><code class="t">:defined</code></td><td width="30%"><code class="t">nil</code></td></tr>
<tr><td width="30%">yes</td><td width="30%"><code class="t">:circular</code></td><td width="30%"><code class="t">nil</code></td></tr>
<tr><td width="30%">yes</td><td width="30%"><code class="t">:final</code></td><td width="30%"><var class="var">final-object</var></td></tr>
<tr><td width="30%">yes</td><td width="30%"><code class="t">:final/circular</code></td><td width="30%"><var class="var">final-object</var></td></tr>
</tbody>
</table>

<p>The default method on this generic function is applicable to labeled
object representations returned by the default methods on
<code class="t">note-labeled-object</code> and <code class="t">make-labeled-object</code>.
</p></dd></dl>

<a class="anchor" id="Generic_002dFunction-eclector_002ereader_007cfinalize_002dlabeled_002dobject"></a><dl class="first-deffn">
<dt class="deffn" id="index-finalize_002dlabeled_002dobject-_005beclector_002ereader_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">finalize-labeled-object [eclector.reader]</strong> <var class="def-var-arguments">client labeled-object  object</var><a class="copiable-link" href="#index-finalize_002dlabeled_002dobject-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This generic function is called by the default <code class="t">#=</code> reader macro
function after reading a complete labeled object in order to store
<var class="var">object</var> in <var class="var">labeled-object</var> and change the state of
<var class="var">labeled-object</var> to either <code class="t">:final</code> or <code class="t">:final/circular</code>.  The
function returns two values: the finalized <var class="var">labeled-object</var> and the
new state of <var class="var">labeled-object</var>.
</p>
<p>The default method on this generic function is applicable to labeled
object representations returned by the default methods on
<code class="t">note-labeled-object</code> and <code class="t">make-labeled-object</code>.
</p></dd></dl>

<a class="anchor" id="Generic_002dFunction-eclector_002ereader_007creference_002dlabeled_002dobject"></a><dl class="first-deffn">
<dt class="deffn" id="index-reference_002dlabeled_002dobject-_005beclector_002ereader_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">reference-labeled-object [eclector.reader]</strong> <var class="def-var-arguments">client input-stream  labeled-object</var><a class="copiable-link" href="#index-reference_002dlabeled_002dobject-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This generic function is called by the default <code class="t">##</code> reader macro
function to process a reference to <var class="var">labeled-object</var> while reading
from <var class="var">input-stream</var>.  <var class="var">labeled-object</var> must be a representation
of a labeled object and has, in the context of the <code class="t">##</code> reader macro
function, likely been obtained by calling <code class="t">find-labeled-object</code>.
Depending on the state of <var class="var">labeled-object</var>, this function returns
either <var class="var">labeled-object</var> itself or an object that can be returned to
the caller as-is.  In case <var class="var">labeled-object</var> is returned, it will be
replaced by its associated object later, when <code class="t">fixup-graph</code> is called.
</p>
<p>The default method on this generic function is applicable to labeled
object representations returned by the default methods on
<code class="t">note-labeled-object</code> and <code class="t">make-labeled-object</code>.
</p></dd></dl>

<p>As briefly mentioned above, the generic functions <code class="t">fixup-graph</code> and
<code class="t">fixup</code> traverse and inspect objects in the object graph reachable
from an object that is about to be returned to the caller of
<code class="t">eclector.reader:read</code>.  In order to distinguish ordinary objects from
labeled objects that act as placeholders in the object graph and must be
replaced with their respective final objects, <code class="t">fixup</code> methods call
<code class="t">labeled-object-state</code> on all encountered objects.
<code class="t">labeled-object-state</code> returns <code class="t">nil</code> for all objects that are not
labeled objects and <code class="t">:final</code> for labeled objects which must be
replaced with their final object.
</p>
<a class="anchor" id="Generic_002dFunction-eclector_002ereader_007cfixup_002dgraph_002dp"></a><dl class="first-deffn">
<dt class="deffn" id="index-fixup_002dgraph_002dp-_005beclector_002ereader_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">fixup-graph-p [eclector.reader]</strong> <var class="def-var-arguments">client root-labeled-object</var><a class="copiable-link" href="#index-fixup_002dgraph_002dp-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This generic function is potentially called by a method on
<code class="t">finalize-labeled-object</code> to determine whether the object graph
reachable from the object of <var class="var">root-labeled-object</var> should be fixed
up by calling <code class="t">fixup-graph</code> with <var class="var">client</var> and
<var class="var">labeled-object</var>.
</p>
<p>Multiple default methods on this generic function jointly implement the
following behavior:
</p>
<ul class="itemize mark-bullet">
<li>If <var class="var">root-labeled-object</var> has a parent labeled object,
<var class="var">root-labeled-object</var> should not be fixup up immediately (since the
fixup processing for ancestor labeled objects will subsume the fixup
processing for <var class="var">root-labeled-object</var>).

</li><li>If <var class="var">root-labeled-object</var> does not have parent labeled object but has
child labeled objects, <var class="var">root-labeled-object</var> should be fixed up
immediately.

</li><li>If <var class="var">root-labeled-object</var> does not have parent labeled object and is
in state <code class="t">:final/circular</code>, <var class="var">root-labeled-object</var> should be fixed
up immediately.
</li></ul>
</dd></dl>

<a class="anchor" id="Generic_002dFunction-eclector_002ereader_007cfixup_002dgraph"></a><dl class="first-deffn">
<dt class="deffn" id="index-fixup_002dgraph-_005beclector_002ereader_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">fixup-graph [eclector.reader]</strong> <var class="def-var-arguments">client root-labeled-object <code class="t">&amp;key</code> object-key</var><a class="copiable-link" href="#index-fixup_002dgraph-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This generic function is potentially called after the reader has
constructed an object graph which is reachable from the object of
<var class="var">root-labeled-object</var> and noticed circular references within this
graph to fix up circular references before the object of
<var class="var">root-labeled-object</var> is returned to the caller (of <code class="t">read</code> or
related functions).
</p>
<p><var class="var">object-key</var> is a function that accepts a labeled object and returns
the object of the labeled object.
</p>
<p>The default method on this generic function creates a hash table for
tracking already processed objects and calls <code class="t">fixup</code> with
<var class="var">client</var>, the object of <var class="var">root-labeled-object</var> and the hash table
to recursively process objects in the object graph which is reachable
from the object of <var class="var">root-labeled-object</var>.
</p></dd></dl>

<a class="anchor" id="Generic_002dFunction-eclector_002ereader_007cfixup"></a><dl class="first-deffn">
<dt class="deffn" id="index-fixup-_005beclector_002ereader_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">fixup [eclector.reader]</strong> <var class="def-var-arguments">client object seen-objects</var><a class="copiable-link" href="#index-fixup-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This generic function is potentially called to apply circularity-related
changes to the object constructed by the reader before it is returned to
the caller.  <var class="var">object</var> is the object that should be modified.
<var class="var">seen-objects</var> is a <code class="t">eq</code>-hash table used to track already
processed objects (see below).  A method specialized to a class,
instances of which consists of parts, should modify <var class="var">object</var> by
scanning its parts for labeled object markers, replacing found labeled
object markers with the respective final object and recursively calling
<code class="t">fixup</code> for all parts.
</p>
<p>To recognize labeled objects which have to be replaced, methods should
call <code class="t">labeled-object-state</code> on each part of <var class="var">object</var> and interpret
the returned values as follows: if <code class="t">nil</code> is returned, the part should
not be replaced but recursively processed.  If <code class="t">:final</code> is returned as
the first value, the part should be replaced with the final object that
is returned as the second value.  Parts are replaced by mutating
<var class="var">object</var>.
</p>
<p><code class="t">fixup</code> is called for side effects &ndash; its return value is ignored.
</p>
<p>Default methods specializing the <var class="var">object</var> parameter to <code class="t">cons</code>,
<code class="t">array</code>, <code class="t">standard-object</code> and <code class="t">hash-table</code> process instances of
those classes in the obvious way.
</p>
<p>An unspecialized <code class="t">:around</code> method queries and updates
<var class="var">seen-objects</var> to ensure that each object is processed exactly once.
</p></dd></dl>

<hr>
</div>
<div class="subsection-level-extent" id="S_002dexpression-creation-and-quasiquotation">
<h4 class="subsection" id="S_002dexpression-creation-and-quasiquotation-1"><span>2.3.5 S-expression creation and quasiquotation<a class="copiable-link" href="#S_002dexpression-creation-and-quasiquotation-1"> &para;</a></span></h4>

<a class="index-entry-id" id="index-quotation"></a>

<p>The following generic functions allow clients to construct
representations of quoted and quasiquoted forms.
</p>
<a class="anchor" id="Generic_002dFunction-eclector_002ereader_007cwrap_002din_002dquote"></a><dl class="first-deffn">
<dt class="deffn" id="index-wrap_002din_002dquote-_005beclector_002ereader_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">wrap-in-quote [eclector.reader]</strong> <var class="def-var-arguments">client material</var><a class="copiable-link" href="#index-wrap_002din_002dquote-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This generic function is called by the default <code class="t">'</code>-reader macro
function to construct a quotation form in which <var class="var">material</var> is
the quoted material.
</p>
<p>The default method on this generic function returns a result
equivalent to <code class="code">(list 'common-lisp:quote <var class="var">material</var>)</code>.
</p></dd></dl>

<a class="index-entry-id" id="index-quasiquotation"></a>

<a class="anchor" id="Generic_002dFunction-eclector_002ereader_007cwrap_002din_002dquasiquote"></a><dl class="first-deffn">
<dt class="deffn" id="index-wrap_002din_002dquasiquote-_005beclector_002ereader_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">wrap-in-quasiquote [eclector.reader]</strong> <var class="def-var-arguments">client form</var><a class="copiable-link" href="#index-wrap_002din_002dquasiquote-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This generic function is called by the default <code class="t">`</code>-reader macro
function to construct a quasiquotation form in which <var class="var">form</var> is
the quasiquoted material.
</p>
<p>The default method on this generic function returns a result
equivalent to <code class="code">(list 'eclector.reader:quasiquote <var class="var">form</var>)</code>.
</p></dd></dl>

<a class="anchor" id="Generic_002dFunction-eclector_002ereader_007cwrap_002din_002dunquote"></a><dl class="first-deffn">
<dt class="deffn" id="index-wrap_002din_002dunquote-_005beclector_002ereader_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">wrap-in-unquote [eclector.reader]</strong> <var class="def-var-arguments">client form</var><a class="copiable-link" href="#index-wrap_002din_002dunquote-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This generic function is called by the default <code class="t">,</code>-reader macro
function to construct an unquote form in which <var class="var">form</var> is the
unquoted material.
</p>
<p>The default method on this generic function returns a result
equivalent to <code class="code">(list 'eclector.reader:unquote <var class="var">form</var>)</code>.
</p></dd></dl>

<a class="anchor" id="Generic_002dFunction-eclector_002ereader_007cwrap_002din_002dunquote_002dsplicing"></a><dl class="first-deffn">
<dt class="deffn" id="index-wrap_002din_002dunquote_002dsplicing-_005beclector_002ereader_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">wrap-in-unquote-splicing [eclector.reader]</strong> <var class="def-var-arguments">client form</var><a class="copiable-link" href="#index-wrap_002din_002dunquote_002dsplicing-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This generic function is called by the default <code class="t">,@</code>-reader macro
function to construct a splicing unquote form in which <var class="var">form</var> is the
unquoted material.
</p>
<p>The default method on this generic function returns a result
equivalent to
<code class="code">(list 'eclector.reader:unquote-splicing <var class="var">form</var>)</code>.
</p></dd></dl>

<p>Backquote and unquote syntax is forbidden in some contexts such as
multi-dimensional array literals (<code class="t">#A</code>) and structure literals
(<code class="t">#S</code>) thus Eclector has a mechanism for controlling whether
backquote, unquote or both should be allowed in a given context.
Since custom reader macros may also have to control this aspect,
Eclector provides an external protocol:
</p>
<a class="anchor" id="Macro-eclector_002ereader_007cwith_002dforbidden_002dquasiquotation"></a><dl class="first-deffn">
<dt class="deffn" id="index-with_002dforbidden_002dquasiquotation-_005beclector_002ereader_005d"><span class="category-def">Macro: </span><span><strong class="def-name">with-forbidden-quasiquotation [eclector.reader]</strong> <var class="def-var-arguments">context  <code class="t">&amp;optional</code>  (quasiquote-forbidden-p <code class="t">t</code>)  (unquote-forbidden-p <code class="t">t</code>)  <code class="t">&amp;body</code> body</var><a class="copiable-link" href="#index-with_002dforbidden_002dquasiquotation-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>Disallow backquote syntax, unquote syntax or both in <code class="t">read</code>
functions called during the execution of <var class="var">body</var>.
<var class="var">context</var> is a symbol identifying the current context which is
used for error reporting.  A typical value is the name of the reader
macro function in which this macro is used.
<var class="var">quasiquote-forbidden-p</var> controls whether backquote syntax
should be forbidden.  The value <code class="t">:keep</code> causes the binding to
remain unchanged.  <var class="var">unquote-forbidden-p</var> controls whether
unquote syntax should be forbidden.  The value <code class="t">:keep</code> causes
the binding to remain unchanged.
</p></dd></dl>

<a class="index-entry-id" id="index-function"></a>

<a class="anchor" id="Generic_002dFunction-eclector_002ereader_007cwrap_002din_002dfunction"></a><dl class="first-deffn">
<dt class="deffn" id="index-wrap_002din_002dfunction-_005beclector_002ereader_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">wrap-in-function [eclector.reader]</strong> <var class="def-var-arguments">client name</var><a class="copiable-link" href="#index-wrap_002din_002dfunction-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This generic function is called by the default <code class="t">#'</code>-reader macro
function to construct a form that applies the <code class="t">function</code> special
operator to the <var class="var">name</var> expression.
</p>
<p>The default method on this generic function returns a result equivalent
to <code class="code">(list 'common-lisp:function <var class="var">form</var>)</code>.
</p></dd></dl>

<hr>
</div>
<div class="subsection-level-extent" id="Readtable-initialization">
<h4 class="subsection" id="Readtable-initialization-1"><span>2.3.6 Readtable initialization<a class="copiable-link" href="#Readtable-initialization-1"> &para;</a></span></h4>

<a class="index-entry-id" id="index-readtable-1"></a>

<p>The standard syntax types and macro character associations used by the
ordinary reader can be set up for any readtable object implementing the
readtable protocol (see <a class="pxref" href="#Readtable-features">Readtable features</a>).  The
following functions are provided for this purpose:
</p>
<a class="anchor" id="Function-eclector_002ereader_007cset_002dstandard_002dsyntax_002dtypes"></a><dl class="first-deffn">
<dt class="deffn" id="index-set_002dstandard_002dsyntax_002dtypes-_005beclector_002ereader_005d"><span class="category-def">Function: </span><span><strong class="def-name">set-standard-syntax-types [eclector.reader]</strong> <var class="def-var-arguments">readtable</var><a class="copiable-link" href="#index-set_002dstandard_002dsyntax_002dtypes-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This function sets the standard syntax types in <var class="var">readtable</var>
(See HyperSpec section 2.1.4.)
</p></dd></dl>

<a class="anchor" id="Function-eclector_002ereader_007cset_002dstandard_002dmacro_002dcharacters"></a><dl class="first-deffn">
<dt class="deffn" id="index-set_002dstandard_002dmacro_002dcharacters-_005beclector_002ereader_005d"><span class="category-def">Function: </span><span><strong class="def-name">set-standard-macro-characters [eclector.reader]</strong> <var class="def-var-arguments">readtable</var><a class="copiable-link" href="#index-set_002dstandard_002dmacro_002dcharacters-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This function sets the standard macro characters in <var class="var">readtable</var>
(See HyperSpec section 2.4.)
</p></dd></dl>

<a class="anchor" id="Function-eclector_002ereader_007cset_002dstandard_002ddispatch_002dmacro_002dcharacters"></a><dl class="first-deffn">
<dt class="deffn" id="index-set_002dstandard_002ddispatch_002dmacro_002dcharacters-_005beclector_002ereader_005d"><span class="category-def">Function: </span><span><strong class="def-name">set-standard-dispatch-macro-characters [eclector.reader]</strong> <var class="def-var-arguments">readtable</var><a class="copiable-link" href="#index-set_002dstandard_002ddispatch_002dmacro_002dcharacters-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This function sets the standard dispatch macro characters, that is
sharpsign and its sub-characters, in <var class="var">readtable</var> (See HyperSpec
section 2.4.8.)
</p></dd></dl>

<a class="anchor" id="Function-eclector_002ereader_007cset_002dstandard_002dsyntax_002dand_002dmacros"></a><dl class="first-deffn">
<dt class="deffn" id="index-set_002dstandard_002dsyntax_002dand_002dmacros-_005beclector_002ereader_005d"><span class="category-def">Function: </span><span><strong class="def-name">set-standard-syntax-and-macros [eclector.reader]</strong> <var class="def-var-arguments">readtable</var><a class="copiable-link" href="#index-set_002dstandard_002dsyntax_002dand_002dmacros-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This function sets the standard syntax types and macro characters in
<var class="var">readtable</var> by calling the above three functions.
</p></dd></dl>

<hr>
</div>
</div>
<div class="section-level-extent" id="Readtable-features">
<h3 class="section" id="Readtable-features-1"><span>2.4 Readtable features<a class="copiable-link" href="#Readtable-features-1"> &para;</a></span></h3>

<a class="index-entry-id" id="index-readtable-2"></a>

<p>In this section, symbols written without package marker are in the
<code class="t">eclector.readtable</code> package (see <a class="pxref" href="#Package-for-readtable-features">Package for readtable features</a>).
</p>
<p>This package exports two kinds of symbols:
</p>
<ol class="enumerate">
<li> Symbols the names of which correspond to the names of symbols in the
<code class="t">common-lisp</code> package.  The functions bound to these symbols are
generic versions of the corresponding standard Common Lisp functions.
Clients can define custom readtables by defining methods on these
generic functions.

</li><li> Symbols bound to additional functions and condition types.
</li></ol>

<a class="anchor" id="Generic_002dFunction-eclector_002ereadtable_007creadtablep"></a><dl class="first-deffn">
<dt class="deffn" id="index-readtablep-_005beclector_002ereadtable_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">readtablep [eclector.readtable]</strong> <var class="def-var-arguments">object</var><a class="copiable-link" href="#index-readtablep-_005beclector_002ereadtable_005d"> &para;</a></span></dt>
<dd>
<p>This function is the generic version of the standard Common Lisp
function <code class="t">cl:readtablep</code>.  The function returns true if
<var class="var">object</var> can be used as a readtable in Eclector via the
protocol functions in the <code class="t">ecelctor.readtable</code> package.  The
default method returns <code class="t">nil</code>.
</p></dd></dl>

<p>TODO
</p>
<hr>
</div>
<div class="section-level-extent" id="Parse-result-construction-features">
<h3 class="section" id="Parse-result-construction-features-1"><span>2.5 Parse result construction features<a class="copiable-link" href="#Parse-result-construction-features-1"> &para;</a></span></h3>

<a class="index-entry-id" id="index-client-1"></a>
<a class="index-entry-id" id="index-parse-result-4"></a>

<p>In this section, symbols written without package marker are in the
<code class="t">eclector.parse-result</code> package (see <a class="pxref" href="#Package-for-parse-result-construction-features">Package for parse result construction features</a>).
</p>
<p>This package provides clients with a reader that behaves similarly to
<code class="t">cl:read</code> but returns custom parse result objects controlled by
the client.  Some parse results correspond to things like symbols,
numbers and lists that <code class="t">cl:read</code> would return, while others, if
the client chooses, represent comments and other kinds of input that
<code class="t">cl:read</code> would discard.  Furthermore, clients can associate
source location information with parse results.
</p>
<p>Clients using this package pass a &ldquo;client&rdquo; object for which methods on
the generic functions described below are applicable to <code class="t">read</code>,
<code class="t">read-preserving-whitespace</code> or <code class="t">read-from-string</code>.  Suitable client
classes can be defined by using <code class="t">parse-result-client</code> as a superclass
and at least defining a method on the generic function
<code class="t">make-expression-result</code>.
</p>
<p>When a client constructs parse results, some of the generic functions
for customizing the behavior of the reader (see <a class="pxref" href="#Reader-behavior-protocol">Reader behavior protocol</a>) return additional values:
</p>
<table class="multitable">
<thead><tr><th width="25%">Generic function</th><th width="15%">Situation</th><th width="30%">Ordinary values</th><th width="30%">Extended values</th></tr></thead>
<tbody><tr><td width="25%"><code class="t">eclector.reader:call-as-top-level-read</code></td><td width="15%">object</td><td width="30%"><em class="emph">object</em></td><td width="30%"><em class="emph">object</em>, <em class="emph">parse result</em>, <em class="emph">orphan results</em></td></tr>
<tr><td width="25%"><code class="t">eclector.reader:read-common</code></td><td width="15%">object</td><td width="30%"><em class="emph">object</em></td><td width="30%"><em class="emph">object</em>, <em class="emph">parse result</em></td></tr>
<tr><td width="25%"><code class="t">eclector.reader:read-maybe-nothing</code></td><td width="15%">object</td><td width="30%"><em class="emph">object</em>, <em class="emph">kind</em></td><td width="30%"><em class="emph">object</em>, <em class="emph">kind</em>, <em class="emph">parse result</em></td></tr>
<tr><td width="25%"><code class="t">eclector.reader:call-as-top-level-read</code></td><td width="15%">end of input</td><td width="30%"><var class="var">eof-value</var></td><td width="30%"><var class="var">eof-value</var>, <em class="emph">orphan results</em></td></tr>
<tr><td width="25%"><code class="t">eclector.reader:read-common</code></td><td width="15%">end of input</td><td width="30%"><var class="var">eof-value</var></td><td width="30%"><var class="var">eof-value</var></td></tr>
<tr><td width="25%"><code class="t">eclector.reader:read-maybe-nothing</code></td><td width="15%">end of input</td><td width="30%"><var class="var">eof-value</var>, <code class="t">:eof</code></td><td width="30%"><var class="var">eof-value</var>, <code class="t">:eof</code></td></tr>
</tbody>
</table>

<p>Note how <code class="t">eclector.reader:call-as-top-level-read</code> and
<code class="t">eclector.reader:read-common</code> return fewer values for the &ldquo;end of
input&rdquo; situation.  This difference in return value count allows the
caller to recognize the &ldquo;end of input&rdquo; situation even if
<var class="var">eof-value</var> is an object that could be read such as <code class="t">nil</code>.  Using
such an <var class="var">eof-value</var> makes sense for clients which construct parse
results since top-level <code class="t">eclector.parse-result:read</code> calls return
these parse results so that there is no risk of confusing the chosen
<var class="var">eof-value</var>, even if something like <code class="t">nil</code>, with having read a
similar object.
</p>
<div class="float" id="fig_003aread_002dcall_002dsequence_002dparse_002dresult">
<div class="center"><img class="image" src="read-call-sequence-parse-result.png" alt="read-call-sequence-parse-result">
</div><div class="caption"><p><strong class="strong">Figure 2.5: </strong>Functions and typical function call sequences.  Solid arrows
represent calls, dashed arrows represent returns from function calls.
Labels above arrows represent arguments and return values.  Differences
from the non-parse result version are highlighted with bold text.</p></div></div>
<p><a class="ref" href="#fig_003aread_002dcall_002dsequence_002dparse_002dresult">Figure 2.5</a> shows typical function call
patterns, including ordinary and additional return values, that arise
when the functions <code class="t">read</code>, <code class="t">read-preserving-whitespace</code>,
<code class="t">read-from-string</code> and <code class="t">read-delimited-list</code> are called by client
code.
</p>
<a class="anchor" id="Function-eclector_002eparse_002dresult_007cread"></a><dl class="first-deffn">
<dt class="deffn" id="index-read-_005beclector_002eparse_002dresult_005d"><span class="category-def">Function: </span><span><strong class="def-name">read [eclector.parse-result]</strong> <var class="def-var-arguments">client <code class="t">&amp;optional</code>  (input-stream <code class="t">*standard-input*</code>)  (eof-error-p <code class="t">t</code>)  (eof-value <code class="t">nil</code>)</var><a class="copiable-link" href="#index-read-_005beclector_002eparse_002dresult_005d"> &para;</a></span></dt>
<dd>
<p>This function is the main entry point for this variant of the reader.
It is in many ways similar to the standard Common Lisp function
<code class="t">cl:read</code>.  The differences are:
</p>
<ul class="itemize mark-bullet">
<li>A client instance must be supplied as the first argument.

</li><li>The first return value, unless <var class="var">eof-value</var> is returned, is an
arbitrary parse result object created by the client, not generally the
read object.

</li><li>The second return value, unless <var class="var">eof-value</var> is returned, is a list
of &ldquo;orphan&rdquo; results.  These results are return values of
<code class="t">make-skipped-input-result</code> and arise when skipping input at the
toplevel such as comments which are not lexically contained in lists:
<code class="t">#|orphan|# (#|not orphan|#)</code>.

</li><li>The function does not accept a <var class="var">recursive</var> parameter since it sets
up a dynamic environment in which calls to <code class="t">eclector.reader:read</code>
behave suitably.
</li></ul>
</dd></dl>

<a class="anchor" id="Function-eclector_002eparse_002dresult_007cread_002dpreserving_002dwhitespace"></a><dl class="first-deffn">
<dt class="deffn" id="index-read_002dpreserving_002dwhitespace-_005beclector_002eparse_002dresult_005d"><span class="category-def">Function: </span><span><strong class="def-name">read-preserving-whitespace [eclector.parse-result]</strong> <var class="def-var-arguments">client  <code class="t">&amp;optional</code> (input-stream <code class="t">*standard-input*</code>)  (eof-error-p <code class="t">t</code>)  (eof-value <code class="t">nil</code>)</var><a class="copiable-link" href="#index-read_002dpreserving_002dwhitespace-_005beclector_002eparse_002dresult_005d"> &para;</a></span></dt>
<dd>
<p>This function is similar to the standard Common Lisp function
<code class="t">cl:read-preserving-whitespace</code>.  The differences are the same
as described above for <code class="t">read</code> compared to <code class="t">cl:read</code>.
</p></dd></dl>

<a class="anchor" id="Function-eclector_002eparse_002dresult_007cread_002dfrom_002dstring"></a><dl class="first-deffn">
<dt class="deffn" id="index-read_002dfrom_002dstring-_005beclector_002eparse_002dresult_005d"><span class="category-def">Function: </span><span><strong class="def-name">read-from-string [eclector.parse-result]</strong> <var class="def-var-arguments">client string   <code class="t">&amp;optional</code>  (eof-error-p <code class="t">t</code>)  (eof-value <code class="t">nil</code>)  <code class="t">&amp;key</code>  (start <code class="t">0</code>)  (end <code class="t">nil</code>)  (preserve-whitespace <code class="t">nil</code>)</var><a class="copiable-link" href="#index-read_002dfrom_002dstring-_005beclector_002eparse_002dresult_005d"> &para;</a></span></dt>
<dd>
<p>This function is similar to the standard Common Lisp function
<code class="t">cl:read-from-string</code>.  The differences are:
</p>
<ul class="itemize mark-bullet">
<li>A client instance must be supplied as the first argument.

</li><li>The first return value, unless <var class="var">eof-value</var> is returned, is an
arbitrary parse result object created by the client, not generally the
read object.

</li><li>The <em class="emph">third</em> return value, unless <var class="var">eof-value</var> is returned, is a
list of &ldquo;orphan&rdquo; results (Described above).
</li></ul>
</dd></dl>

<a class="anchor" id="Class-eclector_002eparse_002dresult_007cparse_002dresult_002dclient"></a><dl class="first-deftp">
<dt class="deftp" id="index-parse_002dresult_002dclient-_005beclector_002eparse_002dresult_005d"><span class="category-def">Class: </span><span><strong class="def-name">parse-result-client [eclector.parse-result]</strong><a class="copiable-link" href="#index-parse_002dresult_002dclient-_005beclector_002eparse_002dresult_005d"> &para;</a></span></dt>
<dd>
<p>This class should generally be used as a superclass for client classes
using this package.
</p></dd></dl>

<a class="anchor" id="Generic_002dFunction-eclector_002eparse_002dresult_007cmake_002dexpression_002dresult"></a><dl class="first-deffn">
<dt class="deffn" id="index-make_002dexpression_002dresult-_005beclector_002eparse_002dresult_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">make-expression-result [eclector.parse-result]</strong> <var class="def-var-arguments">client result  children source</var><a class="copiable-link" href="#index-make_002dexpression_002dresult-_005beclector_002eparse_002dresult_005d"> &para;</a></span></dt>
<dd>
<p>This generic function is called in order to construct a parse result
object.  The value of the <var class="var">result</var> parameter is the raw object read.
The value of the <var class="var">children</var> parameter is a list of already
constructed parse result objects representing objects read by recursive
<code class="t">read</code> calls.  The value of the <var class="var">source</var> parameter is a source
range, as returned by <code class="t">eclector.base:make-source-range</code> and
<code class="t">eclector.base:source-position</code> delimiting the range of characters
from which <var class="var">result</var> has been read.
</p>
<p>This generic function does not have a default method since the purpose
of the package is the construction of <em class="emph">custom</em> parse results.
Thus, a client must define a method on this generic function.
</p></dd></dl>

<a class="anchor" id="Generic_002dFunction-eclector_002eparse_002dresult_007cmake_002dskipped_002dinput_002dresult"></a><dl class="first-deffn">
<dt class="deffn" id="index-make_002dskipped_002dinput_002dresult-_005beclector_002eparse_002dresult_005d"><span class="category-def">Generic Function: </span><span><strong class="def-name">make-skipped-input-result [eclector.parse-result]</strong> <var class="def-var-arguments">client  stream reason source</var><a class="copiable-link" href="#index-make_002dskipped_002dinput_002dresult-_005beclector_002eparse_002dresult_005d"> &para;</a></span></dt>
<dd>
<p>This generic function is called after the reader skipped over a range
of characters in <var class="var">stream</var>.  It returns either <code class="t">nil</code> if
the skipped input should not be represented or a client-specific
representation of the skipped input.  The value of the <var class="var">source</var>
parameter designates the skipped range using a source range
representation obtained via <code class="t">make-source-range</code> and
<code class="t">source-position</code>.
</p>
<p>Reasons for skipping input include comments, the <code class="t">#+</code> and
<code class="t">#-</code> reader macros and <code class="t">*read-suppress*</code>.  The
aforementioned reasons are reflected by the value of the
<var class="var">reason</var> parameter as follows:
</p>
<table class="multitable">
<thead><tr><th width="50%">Input</th><th width="50%">Value of the <var class="var">reason</var> parameter</th></tr></thead>
<tbody><tr><td width="50%">Comment starting with <code class="t">;</code></td><td width="50%"><code class="t">(:line-comment . 1)</code></td></tr>
<tr><td width="50%">Comment starting with <code class="t">;;</code></td><td width="50%"><code class="t">(:line-comment . 2)</code></td></tr>
<tr><td width="50%">Comment starting with <em class="math">n</em> <code class="t">;</code></td><td width="50%"><code class="t">(:line-comment . <em class="math">n</em>)</code></td></tr>
<tr><td width="50%">Comment delimited by <code class="t">#|</code> <code class="t">|#</code></td><td width="50%"><code class="t">:block-comment</code></td></tr>
<tr><td width="50%"><code class="t">#+<em class="emph">false-expression</em></code></td><td width="50%"><code class="t">(:sharpsign-plus . <em class="emph">false-expression</em>)</code></td></tr>
<tr><td width="50%"><code class="t">#-<em class="emph">true-expression</em></code></td><td width="50%"><code class="t">(:sharpsign-minus . <em class="emph">true-expression</em>)</code></td></tr>
<tr><td width="50%"><code class="t">*read-suppress*</code> is true</td><td width="50%"><code class="t">*read-suppress*</code></td></tr>
<tr><td width="50%">A reader macro returns no values</td><td width="50%"><code class="t">:reader-macro</code></td></tr>
</tbody>
</table>

<p>The default method returns <code class="t">nil</code>, that is the skipped input is
not represented as a parse result.
</p></dd></dl>

<hr>
</div>
<div class="section-level-extent" id="CST-reader-features">
<h3 class="section" id="CST-reader-features-1"><span>2.6 CST reader features<a class="copiable-link" href="#CST-reader-features-1"> &para;</a></span></h3>

<a class="index-entry-id" id="index-parse-result-5"></a>
<a class="index-entry-id" id="index-concrete-syntax-tree-2"></a>

<p>In this section, symbols written without package marker are in the
<code class="t">eclector.concrete-syntax-tree</code> package (see <a class="pxref" href="#Package-for-CST-features">Package for CST features</a>).
</p>
<a class="anchor" id="Function-eclector_002econcrete_002dsyntax_002dtree_007cread"></a><dl class="first-deffn">
<dt class="deffn" id="index-read-_005beclector_002econcrete_002dsyntax_002dtree_005d"><span class="category-def">Function: </span><span><strong class="def-name">read [eclector.concrete-syntax-tree]</strong> <var class="def-var-arguments"><code class="t">&amp;optional</code>  (input-stream <code class="t">*standard-input*</code>)  (eof-error-p <code class="t">t</code>)  (eof-value <code class="t">nil</code>)</var><a class="copiable-link" href="#index-read-_005beclector_002econcrete_002dsyntax_002dtree_005d"> &para;</a></span></dt>
<dd>
<p>This function is the main entry point for the CST reader.  It is
mostly compatible with the standard Common Lisp function
<code class="t">cl:read</code>.  The differences are:
</p>
<ul class="itemize mark-bullet">
<li>The return value, unless <var class="var">eof-value</var> is returned, is an instance of
a subclass of <code class="t">concrete-syntax-tree:cst</code>.

</li><li>The function does not accept a <var class="var">recursive</var> parameter since it sets
up a dynamic environment in which calls to <code class="t">eclector.reader:read</code>
behave suitably.
</li></ul>
</dd></dl>

<a class="anchor" id="Function-eclector_002econcrete_002dsyntax_002dtree_007cread_002dpreserving_002dwhitespace"></a><dl class="first-deffn">
<dt class="deffn" id="index-read_002dpreserving_002dwhitespace-_005beclector_002econcrete_002dsyntax_002dtree_005d"><span class="category-def">Function: </span><span><strong class="def-name">read-preserving-whitespace [eclector.concrete-syntax-tree]</strong> <var class="def-var-arguments"><code class="t">&amp;optional</code> (input-stream <code class="t">*standard-input*</code>) (eof-error-p <code class="t">t</code>)  (eof-value <code class="t">nil</code>)</var><a class="copiable-link" href="#index-read_002dpreserving_002dwhitespace-_005beclector_002econcrete_002dsyntax_002dtree_005d"> &para;</a></span></dt>
<dd>
<p>This function is similar to the standard Common Lisp function
<code class="t">cl:read-preserving-whitespace</code>.  The differences are the same
as described above for <code class="t">read</code> compared to <code class="t">cl:read</code>.
</p></dd></dl>

<a class="anchor" id="Function-eclector_002econcrete_002dsyntax_002dtree_007cread_002dfrom_002dstring"></a><dl class="first-deffn">
<dt class="deffn" id="index-read_002dfrom_002dstring-_005beclector_002econcrete_002dsyntax_002dtree_005d"><span class="category-def">Function: </span><span><strong class="def-name">read-from-string [eclector.concrete-syntax-tree]</strong> <var class="def-var-arguments">string  <code class="t">&amp;optional</code>  (eof-error-p <code class="t">t</code>)  (eof-value <code class="t">nil</code>)  <code class="t">&amp;key</code>  (start <code class="t">0</code>)  (end <code class="t">nil</code>)  (preserve-whitespace <code class="t">nil</code>)</var><a class="copiable-link" href="#index-read_002dfrom_002dstring-_005beclector_002econcrete_002dsyntax_002dtree_005d"> &para;</a></span></dt>
<dd>
<p>This function is similar to the standard Common Lisp function
<code class="t">cl:read-from-string</code>.  The differences are the same as
described above for <code class="t">read</code> compared to <code class="t">cl:read</code>.
</p></dd></dl>
<hr>
</div>
</div>
<div class="chapter-level-extent" id="Recovering-from-errors">
<h2 class="chapter" id="Recovering-from-errors-1"><span>3 Recovering from errors<a class="copiable-link" href="#Recovering-from-errors-1"> &para;</a></span></h2>

<a class="index-entry-id" id="index-error"></a>
<a class="index-entry-id" id="index-recovery"></a>


<hr>
<div class="section-level-extent" id="Error-recovery-features">
<h3 class="section" id="Error-recovery-features-1"><span>3.1 Error recovery features<a class="copiable-link" href="#Error-recovery-features-1"> &para;</a></span></h3>

<p>Eclector offers extensive support for recovering from many syntax
errors, continuing to read from the input stream and return a result
that somewhat resembles what would have been returned in case the
syntax had been valid.  To this end, a restart named
<code class="t">eclector.reader:recover</code> is established when recoverable
errors are signaled.  Like the standard Common Lisp restart
<code class="t">cl:continue</code>, this restart can be invoked by a function of the
same name:
</p>
<a class="anchor" id="Function-eclector_002ereader_007crecover"></a><dl class="first-deffn">
<dt class="deffn" id="index-recover-_005beclector_002ereader_005d"><span class="category-def">Function: </span><span><strong class="def-name">recover [eclector.reader]</strong> <var class="def-var-arguments"><code class="t">&amp;optional</code> condition</var><a class="copiable-link" href="#index-recover-_005beclector_002ereader_005d"> &para;</a></span></dt>
<dd>
<p>This function recovers from an error by invoking the most recently
established applicable restart named <code class="t">eclector.reader:recover</code>.  If no
such restart is currently established, it returns <code class="t">nil</code>.  If
<var class="var">condition</var> is non-<code class="t">nil</code>, only restarts that are either explicitly
associated with <var class="var">condition</var>, or not associated with any condition
are considered.
</p></dd></dl>

<p>When a <code class="t">read</code> call during which error recovery has been
performed returns, Eclector tries to return an object that is
similar in terms of type, numeric value, sequence length, etc. to what
would have been returned in case the input had been well-formed.  For
example, recovering after encountering the invalid digit in
<code class="t">#b11311</code> returns either the number <code class="t">#b11011</code> or the
number <code class="t">#b11111</code>.
</p>
<hr>
</div>
<div class="section-level-extent" id="Recoverable-errors">
<h3 class="section" id="Recoverable-errors-1"><span>3.2 Recoverable errors<a class="copiable-link" href="#Recoverable-errors-1"> &para;</a></span></h3>

<p>A syntax error and a corresponding recovery strategy are characterized
by the type of the signaled condition and the report of the
established <code class="t">eclector.reader:recover</code> restart respectively.
Attempting to list and describe all examples of both would provide
little insight.  Instead, this section describes different classes of
errors and corresponding recovery strategies in broad terms:
</p>

<ul class="itemize mark-bullet">
<li>Replace a missing numeric macro parameter or ignore an invalid numeric
macro parameter.  Examples: <code class="t">#=1</code> ⟶ <code class="t">1</code>,
<code class="t">#5P&quot;.&quot;</code> ⟶ <code class="t">#P&quot;.&quot;</code>

</li><li>Add a missing closing delimiter.  Examples:
<code class="t">&quot;foo</code> ⟶ <code class="t">&quot;foo&quot;</code>, <code class="t">(1 2</code> ⟶ <code class="t">(1 2)</code>,
<code class="t">#(1 2</code> ⟶ <code class="t">#(1 2)</code>, <code class="t">#C(1 2</code> ⟶ <code class="t">#C(1 2)</code>

</li><li>Replace an invalid digit or an invalid number with a valid one.  This
includes digits which are invalid for a given base but also things like
<em class="math">0</em> denominator.  Examples: <code class="t">#12rc</code> ⟶ <code class="t">1</code>,
<code class="t">1/0</code> ⟶ <code class="t">1</code>, <code class="t">#C(1 :foo)</code> ⟶ <code class="t">#C(1 1)</code>

</li><li>Replace an invalid character with a valid one.  Example:
<code class="t">#\foo</code> ⟶ <code class="t">#\?</code>

</li><li>Invalid constructs can sometimes be ignored.  Examples:
<code class="t">(,1)</code> ⟶ <code class="t">(1)</code>, <code class="t">#S(foo :bar 1 2 3)</code> ⟶ <code class="t">#S(foo
:bar 1)</code>

</li><li>Excess parts can often be ignored.  Examples: <code class="t">#C(1 2
  3)</code> ⟶ <code class="t">#C(1 2)</code>, <code class="t">#2(1 2 3)</code> ⟶ <code class="t">#2(1 2)</code>

</li><li>Replace an entire construct by some fallback value.  Example:
<code class="t">#S(5)</code> ⟶ <code class="t">nil</code>, <code class="t">(#1=)</code> ⟶ <code class="t">(nil)</code>
</li></ul>

<hr>
</div>
<div class="section-level-extent" id="Potential-problems">
<h3 class="section" id="Potential-problems-1"><span>3.3 Potential problems<a class="copiable-link" href="#Potential-problems-1"> &para;</a></span></h3>

<p>Note that attempting to recover from syntax errors may lead to apparent
success in the sense that the <code class="t">read</code> call returns an object, but this
object may not be what the caller wanted.  For example, recovering from
the missing closing <code class="t">&quot;</code> in the following example
</p>
<div class="example lisp">
<pre class="lisp-preformatted">(defun foo (x y)
  &quot;My documentation string
  (+ x y))
</pre></div>

<p>results in <code class="code">(DEFUN FOO (X Y) &quot;My documentation string&lt;newline&gt;  (+ x y))&quot;)</code>,
not <code class="code">(DEFUN FOO (X Y) &quot;My documentation string&quot; (+ x y))</code>.
</p><hr>
</div>
</div>
<div class="chapter-level-extent" id="Side-effects">
<h2 class="chapter" id="Side-effects-1"><span>4 Side effects<a class="copiable-link" href="#Side-effects-1"> &para;</a></span></h2>

<a class="index-entry-id" id="index-side-effects"></a>

<p>This chapter describes potential side effects of calling
<code class="t">eclector.reader:read</code>,
<code class="t">eclector.reader:read-preserving-whitespace</code> or
<code class="t">eclector.reader:read-from-string</code> for different kinds of
clients.
</p>

<hr>
<div class="section-level-extent" id="Potential-side-effects-for-the-default-client">
<h3 class="section" id="Potential-side-effects-for-the-default-client-1"><span>4.1 Potential side effects for the default client<a class="copiable-link" href="#Potential-side-effects-for-the-default-client-1"> &para;</a></span></h3>

<p>The following destructive modifications are considered uninteresting
and ignored in the remainder of this section:
</p>
<ul class="itemize mark-bullet">
<li>Changes to the state of streams passed to the functions mentioned above.

</li><li>Changes to objects within expressions currently being read.

</li></ul>

<p>Furthermore, the remainder of this section is written under the
following assumptions:
</p>
<ul class="itemize mark-bullet">
<li>The stream object passed to <code class="t">eclector.reader:read</code> does not cause
additional side effects on its own.

</li><li>The variable <code class="t">eclector.reader:*client*</code> is bound to an object for
which there are no custom applicable methods on generic functions
belonging to protocols provided by Eclector that introduce additional
side effects.

</li><li>The variable <code class="t">eclector.readtable:*readtable*</code> is bound to an object for
which

<ul class="itemize mark-bullet">
<li>there are no custom applicable methods on generic functions belonging to
protocols provided by Eclector that introduce additional side effects

</li><li>no non-default macro functions have been installed

</li></ul>

</li></ul>

<p>If any of the above assumptions does not hold, &ldquo;all bets are off&rdquo; in
the sense that arbitrary side effects other than the ones described
below are possible.  For notes regarding non-default clients,
See <a class="xref" href="#Potential-side-effects-for-non_002ddefault-clients">Potential side effects for non-default clients</a>.
</p>

<hr>
<div class="subsection-level-extent" id="Symbols-and-packages-_0028default-client_0029">
<h4 class="subsection" id="Symbols-and-packages-_0028default-client_0029-1"><span>4.1.1 Symbols and packages (default client)<a class="copiable-link" href="#Symbols-and-packages-_0028default-client_0029-1"> &para;</a></span></h4>

<p>The default method on the generic function
<code class="t">eclector.reader:interpret-symbol</code> may create and intern
symbols, thereby modifying the package system.
</p>
<hr>
</div>
<div class="subsection-level-extent" id="Read_002dtime-evaluation-_0028default-client_0029">
<h4 class="subsection" id="Read_002dtime-evaluation-_0028default-client_0029-1"><span>4.1.2 Read-time evaluation (default client)<a class="copiable-link" href="#Read_002dtime-evaluation-_0028default-client_0029-1"> &para;</a></span></h4>

<p>The default method on the generic function
<code class="t">eclector.reader:evaluate-expression</code> uses <code class="t">cl:eval</code> to
evaluate arbitrary expressions, potentially causing side effects.
With the default readtable, the generic function is only called by the
macro function of the <code class="t">#.</code> reader macro.
</p>
<hr>
</div>
<div class="subsection-level-extent" id="Standard-reader-macros-_0028default-client_0029">
<h4 class="subsection" id="Standard-reader-macros-_0028default-client_0029-1"><span>4.1.3 Standard reader macros (default client)<a class="copiable-link" href="#Standard-reader-macros-_0028default-client_0029-1"> &para;</a></span></h4>

<p>The default method on the generic function
<code class="t">eclector.reader:call-reader-macro</code> can cause side effects by
calling macro functions that cause side effects.  The following
standard reader macros potentially cause side-effects:
</p>
<ul class="itemize mark-bullet">
<li><code class="t">#.</code> as described in <a class="ref" href="#Read_002dtime-evaluation-_0028default-client_0029">Read-time evaluation (default client)</a>.
</li></ul>

<hr>
</div>
</div>
<div class="section-level-extent" id="Potential-side-effects-for-non_002ddefault-clients">
<h3 class="section" id="Potential-side-effects-for-non_002ddefault-clients-1"><span>4.2 Potential side effects for non-default clients<a class="copiable-link" href="#Potential-side-effects-for-non_002ddefault-clients-1"> &para;</a></span></h3>


<hr>
<div class="subsection-level-extent" id="Symbols-and-packages">
<h4 class="subsection" id="Symbols-and-packages-1"><span>4.2.1 Symbols and packages<a class="copiable-link" href="#Symbols-and-packages-1"> &para;</a></span></h4>

<p>In addition to the potential side effects described in <a class="ref" href="#Symbols-and-packages-_0028default-client_0029">Symbols and packages (default client)</a>, strings passed as the third argument of
<code class="t">eclector.reader:interpret-token</code> are potentially destructively
modified during conversion to the current readtable case.
</p>
<hr>
</div>
<div class="subsection-level-extent" id="Read_002dtime-evaluation">
<h4 class="subsection" id="Read_002dtime-evaluation-1"><span>4.2.2 Read-time evaluation<a class="copiable-link" href="#Read_002dtime-evaluation-1"> &para;</a></span></h4>

<p>The same considerations as in <a class="ref" href="#Read_002dtime-evaluation-_0028default-client_0029">Read-time evaluation (default client)</a> apply.
</p>
<hr>
</div>
<div class="subsection-level-extent" id="Structure-instance-creation">
<h4 class="subsection" id="Structure-instance-creation-1"><span>4.2.3 Structure instance creation<a class="copiable-link" href="#Structure-instance-creation-1"> &para;</a></span></h4>

<p>Clients defining methods on
<code class="t">eclector.reader:make-structure-instance</code> which implement the
standard behavior of calling the default constructor (if any) of the
named structure should consider side effects caused by slot initforms
of the structure.  The following example illustrates this problem:
</p><div class="example lisp">
<pre class="lisp-preformatted">  (defvar *counter* 0)
  (defstruct foo (bar (incf *counter*)))
  #S(foo)
  *counter* &rArr; 1
  #S(foo)
  *counter* &rArr; 2
</pre></div>

<hr>
</div>
<div class="subsection-level-extent" id="Circular-structure">
<h4 class="subsection" id="Circular-structure-1"><span>4.2.4 Circular structure<a class="copiable-link" href="#Circular-structure-1"> &para;</a></span></h4>

<p>The <code class="t">fixup</code> generic function potentially modifies its second
argument destructively.  Clients that define methods on
<code class="t">eclector.reader:make-structure-instance</code> should be aware of
this potential modification in cases like <code class="t">#1=#S(foo :bar
  #1#)</code>.  Similar considerations apply for other ways of
constructing compound objects such as <code class="t">#1=(t . #1#)</code>.
</p>
<hr>
</div>
<div class="subsection-level-extent" id="Standard-reader-macros">
<h4 class="subsection" id="Standard-reader-macros-1"><span>4.2.5 Standard reader macros<a class="copiable-link" href="#Standard-reader-macros-1"> &para;</a></span></h4>

<p>The following standard reader macros could cause or be affected by
side effects when combined with a non-standard client:
</p>
<ul class="itemize mark-bullet">
<li><code class="t">#.</code> as described in <a class="ref" href="#Read_002dtime-evaluation-_0028default-client_0029">Read-time evaluation (default client)</a>.

</li><li><code class="t">#S</code> as described in <a class="ref" href="#Structure-instance-creation">Structure instance creation</a>.

</li><li><code class="t">(</code>, <code class="t">#(</code> and <code class="t">#S</code> as described in <a class="ref" href="#Circular-structure">Circular structure</a>.

</li><li>The <code class="t">,.</code> (i.e. destructively splicing) variant of the <code class="t">,</code> reader
macro does not currently destructively modify the surrounding object,
but clients should not rely on this fact.  This consideration applies to
clients that install non-standard macro functions for the <code class="t">(</code> and
<code class="t">#(</code> reader macros.

</li></ul>
<hr>
</div>
</div>
</div>
<div class="chapter-level-extent" id="Interpretation-of-unclear-parts-of-the-specification">
<h2 class="chapter" id="Interpretation-of-unclear-parts-of-the-specification-1"><span>5 Interpretation of unclear parts of the specification<a class="copiable-link" href="#Interpretation-of-unclear-parts-of-the-specification-1"> &para;</a></span></h2>

<a class="index-entry-id" id="index-specification-interpretation"></a>

<p>This chapter describes Eclector&rsquo;s interpretation of passages in the
Common Lisp specification that do not describe the behavior of a
conforming reader completely unambiguously.
</p>

<hr>
<div class="section-level-extent" id="Interpretation-of-Sharpsign-C-and-Sharpsign-S">
<h3 class="section" id="Interpretation-of-Sharpsign-C-and-Sharpsign-S-1"><span>5.1 Interpretation of Sharpsign C and Sharpsign S<a class="copiable-link" href="#Interpretation-of-Sharpsign-C-and-Sharpsign-S-1"> &para;</a></span></h3>

<a class="index-entry-id" id="index-reader-macro"></a>
<a class="index-entry-id" id="index-complex-literal"></a>
<a class="index-entry-id" id="index-structure-literal"></a>

<p>At first glance, Sharpsign C and Sharpsign S seem to follow the same
syntactic structure: the dispatch macro character followed by the
sub-character followed by a list of a specific structure.  However, the
actual descriptions of the respective syntax is different.  For
Sharpsign C, the specification states:
</p>
<blockquote class="quotation">
<p><code class="t">#C</code> reads a following object, which must be a list of length two
whose elements are both reals.
</p></blockquote>

<p>For Sharpsign S, on the other hand, the specification describes the
syntax as:
</p>
<blockquote class="quotation">
<p><code class="t">#s(<var class="var">name</var> <var class="var">slot1</var> <var class="var">value1</var> <var class="var">slot2</var> <var class="var">value2</var> ...)</code> denotes a structure.
</p></blockquote>

<p>Note how the description for Sharpsign C relies on a recursive <code class="t">read</code>
invocation while the description for Sharpsign S gives a character-level
pattern with meta-syntactic variables.  It is possible that this is an
oversight and the syntax was intended to be uniform between the two
reader macros.  Whatever the case may be, in order to handle existing
code without inconveniencing clients, Eclector implements both
Sharpsign C and Sharpsign S with a recursive <code class="t">read</code> invocation which
corresponds to permissive behavior.
</p>
<p>More concretely, Eclector behaves as summarized in the following table:
</p>
<table class="multitable">
<thead><tr><th width="50%">Input</th><th width="50%">Behavior</th></tr></thead>
<tbody><tr><td width="50%"><code class="t">#C(1 2)</code></td><td width="50%">Read as <code class="t">#C(1 2)</code></td></tr>
<tr><td width="50%"><code class="t">#C (1 2)</code></td><td width="50%">Read as <code class="t">#C(1 2)</code></td></tr>
<tr><td width="50%"><code class="t">#C#||#(1 2)</code></td><td width="50%">Read as <code class="t">#C(1 2)</code></td></tr>
<tr><td width="50%"><code class="t">#C#.(list 1 (+ 2 3))</code></td><td width="50%">Read as <code class="t">#C(1 5)</code></td></tr>
<tr><td width="50%"><code class="t">#C[1 2]</code> for left-parenthesis syntax on <code class="t">[</code></td><td width="50%">Read as <code class="t">#C(1 2)</code></td></tr>
<tr><td width="50%"><code class="t">#S(foo)</code></td><td width="50%">Read as <code class="t">#S(foo)</code></td></tr>
<tr><td width="50%"><code class="t">#S (foo)</code></td><td width="50%">Read as <code class="t">#S(foo)</code></td></tr>
<tr><td width="50%"><code class="t">#S#||#(foo)</code></td><td width="50%">Read as <code class="t">#S(foo)</code></td></tr>
<tr><td width="50%"><code class="t">#S#.(list 'foo)</code></td><td width="50%">Read as <code class="t">#S(foo)</code></td></tr>
<tr><td width="50%"><code class="t">#S[foo]</code> for left-parenthesis syntax on <code class="t">[</code></td><td width="50%">Read as <code class="t">#S(foo)</code></td></tr>
</tbody>
</table>

<p>Eclector provides a strict version of the Sharpsign C macro function
under the name <code class="t">eclector.reader:strict-sharpsign-c</code> which behaves as
follows:
</p>
<table class="multitable">
<thead><tr><th width="50%">Input</th><th width="50%">Behavior</th></tr></thead>
<tbody><tr><td width="50%"><code class="t">#C(1 2)</code></td><td width="50%">Read as <code class="t">#C(1 2)</code></td></tr>
<tr><td width="50%"><code class="t">#C (1 2)</code></td><td width="50%">Rejected</td></tr>
<tr><td width="50%"><code class="t">#C#||#(1 2)</code></td><td width="50%">Rejected</td></tr>
<tr><td width="50%"><code class="t">#C#.(list 1 (+ 2 3))</code></td><td width="50%">Rejected</td></tr>
<tr><td width="50%"><code class="t">#C[1 2]</code> for left-parenthesis syntax on <code class="t">[</code></td><td width="50%">Read as <code class="t">#C(1 2)</code></td></tr>
</tbody>
</table>

<p>Eclector provides a strict version of the Sharpsign S macro function
under the name <code class="t">eclector.reader:strict-sharpsign-s</code> which behaves as
follows:
</p>
<table class="multitable">
<thead><tr><th width="50%">Input</th><th width="50%">Behavior</th></tr></thead>
<tbody><tr><td width="50%"><code class="t">#S(foo)</code></td><td width="50%">Read as <code class="t">#S(foo)</code></td></tr>
<tr><td width="50%"><code class="t">#S (foo)</code></td><td width="50%">Rejected</td></tr>
<tr><td width="50%"><code class="t">#S#||#(foo)</code></td><td width="50%">Rejected</td></tr>
<tr><td width="50%"><code class="t">#S#.(list 'foo)</code></td><td width="50%">Rejected</td></tr>
<tr><td width="50%"><code class="t">#S[foo]</code> for left-parenthesis syntax on <code class="t">[</code></td><td width="50%">Rejected</td></tr>
</tbody>
</table>

<hr>
</div>
<div class="section-level-extent" id="Interpretation-of-Backquote-and-Sharpsign-Single-Quote">
<h3 class="section" id="Interpretation-of-Backquote-and-Sharpsign-Single-Quote-1"><span>5.2 Interpretation of Backquote and Sharpsign Single Quote<a class="copiable-link" href="#Interpretation-of-Backquote-and-Sharpsign-Single-Quote-1"> &para;</a></span></h3>

<a class="index-entry-id" id="index-reader-macro-1"></a>
<a class="index-entry-id" id="index-quasiquote"></a>
<a class="index-entry-id" id="index-function-1"></a>

<p>The Common Lisp specification is very specific about the contexts in
which the quasiquotation mechanism can be used.  Explicit descriptions
of the behavior of the quasiquotation mechanism are given for
expressions which <em class="emph">are</em> lists or vectors and it is implied that
unquote is not allowed in other expressions.  From this description, it
is clear that <code class="t">`#S(foo :bar ,x)</code> is not valid syntax, for example.
However, whether <code class="t">`#',foo</code> is valid syntax depends on whether
<code class="t">#'<var class="var">thing</var></code> is considered to <em class="emph">be</em> a list.  Since <code class="t">`#',foo</code>
is a relatively common idiom, Eclector accepts it by default.
</p>
<p>Eclector provides a strict version of the Sharpsign Single Quote macro
function under the name
<code class="t">eclector.reader:strict-sharpsign-single-quote</code> which does not accept
unquote in the function name.
</p>
<hr>
</div>
<div class="section-level-extent" id="Circular-objects-and-custom-reader-macros">
<h3 class="section" id="Circular-objects-and-custom-reader-macros-1"><span>5.3 Circular objects and custom reader macros<a class="copiable-link" href="#Circular-objects-and-custom-reader-macros-1"> &para;</a></span></h3>

<p>The Common Lisp specification describes the behavior of the <code class="t">##</code>
reader macro as follows:
</p>
<blockquote class="quotation">
<p><code class="t">#<var class="var">n</var>#</code>, where <var class="var">n</var> is a required unsigned decimal integer,
provides a reference to some object labeled by <code class="t">#<var class="var">n</var>=</code>; that is,
<code class="t">#<var class="var">n</var>#</code> represents a pointer to the same (<code class="t">eq</code>) object labeled
by <code class="t">#<var class="var">n</var>=</code>.
</p></blockquote>

<p>The vague phrasing &ldquo;represents a pointer to the same (<code class="t">eq</code>) object&rdquo;
is probably chosen to cover the situation in which the object in
question is not yet defined when the reader encounters the <code class="t">#<var class="var">n</var>#</code>
reference as is the case with input of the form
<code class="t">#<var class="var">n</var>=(…#<var class="var">n</var>#…)</code>.  The fact that the object is not yet defined
when the reference is encountered is not a problem in general except for
one situation: assume <code class="t">#_</code> is a custom reader macro in the current
readtable which calls <code class="t">read</code>.  In this situation, reading an
expression of the form <code class="t">#<var class="var">n</var>=(…#_#<var class="var">n</var>#…)</code> causes the reader
macro function for <code class="t">#_</code> to be called which calls <code class="t">read</code> to read the
following object which encounters the reference. This chain of calls
leads to a potential problem: the <code class="t">read</code> call made by the reader macro
function has to return some object but it cannot return the object
labeled <var class="var">n</var> since that object has not been read yet.  The reader
macro function must therefore receive some sort of
implementation-dependent <a class="footnote" id="DOCF4" href="#FOOT4"><sup>4</sup></a> object which stands in
for the object labeled <var class="var">n</var> and gets replaced at some later time
after the object labeled <var class="var">n</var> has been read.  Since the stand-in
object is implementation-dependent, the reader macro function must not
make any assumptions regarding the type of the object or operate on it
in any way other than returning the object or using the object as a part
of a compound object.
</p>
<p>The following example violates this principle since the reader macro
function in <code class="t">custom-macro-readtable</code> calls <code class="t">cl:second</code> on the object
returned by <code class="t">eclector.reader:read</code>:
</p>
<div class="example lisp">
<pre class="lisp-preformatted">(defun custom-macro-readtable ()
  (let ((readtable (eclector.readtable:copy-readtable
                    eclector.reader:*readtable*)))
    (eclector.readtable:set-dispatch-macro-character
     readtable #\# #\_ (lambda (stream char sub-char)
                         (declare (ignore char sub-char))
                         (second (eclector.reader:read stream t nil t))))
    readtable))

(let ((eclector.reader:*readtable* (custom-macro-readtable)))
  (eclector.reader:read-from-string &quot;#1=(:a #_#1#)&quot;))
&rArr; undefined
</pre></div>

<p>To handle the problem described above, Eclector imposes the following
restriction on custom reader macro functions which call <code class="t">read</code>:
</p>
<blockquote class="quotation">
<p>A reader macro function which reads an object by calling <code class="t">read</code> must
account for the object being of an implementation-dependent type and
must not operate on the object in any way other than returning the
object or using the object as a part of a compound object.
</p></blockquote>

<hr>
</div>
</div>
<div class="unnumbered-level-extent" id="Concept-index">
<h2 class="unnumbered" id="Concept-index-1"><span>Concept index<a class="copiable-link" href="#Concept-index-1"> &para;</a></span></h2>

<div class="printindex cp-printindex">
<table class="cp-letters-header-printindex"><tr><th>Jump to: &nbsp; </th><td><a class="summary-letter-printindex" href="#Concept-index_cp_letter-A"><b>A</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-index_cp_letter-C"><b>C</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-index_cp_letter-E"><b>E</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-index_cp_letter-F"><b>F</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-index_cp_letter-L"><b>L</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-index_cp_letter-P"><b>P</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-index_cp_letter-Q"><b>Q</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-index_cp_letter-R"><b>R</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-index_cp_letter-S"><b>S</b></a>
 &nbsp; 
</td></tr></table>
<table class="cp-entries-printindex" border="0">
<tr><td></td><th class="entries-header-printindex">Index Entry</th><th class="sections-header-printindex">Section</th></tr>
<tr><td colspan="3"><hr></td></tr>
<tr><th id="Concept-index_cp_letter-A">A</th></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-aspect_002c-reader-state">aspect, reader state</a></td><td class="printindex-index-section"><a href="#Reader-state-protocol">Reader state protocol</a></td></tr>
<tr><td colspan="3"><hr></td></tr>
<tr><th id="Concept-index_cp_letter-C">C</th></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-client">client</a></td><td class="printindex-index-section"><a href="#Basic-features">Basic features</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-client-1">client</a></td><td class="printindex-index-section"><a href="#Parse-result-construction-features">Parse result construction features</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-complex-literal">complex literal</a></td><td class="printindex-index-section"><a href="#Interpretation-of-Sharpsign-C-and-Sharpsign-S">Interpretation of Sharpsign C and Sharpsign S</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-concrete-syntax-tree">concrete syntax tree</a></td><td class="printindex-index-section"><a href="#Introduction">Introduction</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-concrete-syntax-tree-1">concrete syntax tree</a></td><td class="printindex-index-section"><a href="#Package-for-CST-features">Package for CST features</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-concrete-syntax-tree-2">concrete syntax tree</a></td><td class="printindex-index-section"><a href="#CST-reader-features">CST reader features</a></td></tr>
<tr><td colspan="3"><hr></td></tr>
<tr><th id="Concept-index_cp_letter-E">E</th></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-error">error</a></td><td class="printindex-index-section"><a href="#Recovering-from-errors">Recovering from errors</a></td></tr>
<tr><td colspan="3"><hr></td></tr>
<tr><th id="Concept-index_cp_letter-F">F</th></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-function">function</a></td><td class="printindex-index-section"><a href="#S_002dexpression-creation-and-quasiquotation">S-expression creation and quasiquotation</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-function-1">function</a></td><td class="printindex-index-section"><a href="#Interpretation-of-Backquote-and-Sharpsign-Single-Quote">Interpretation of Backquote and Sharpsign Single Quote</a></td></tr>
<tr><td colspan="3"><hr></td></tr>
<tr><th id="Concept-index_cp_letter-L">L</th></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-labeled-object">labeled object</a></td><td class="printindex-index-section"><a href="#Labeled-objects-and-references">Labeled objects and references</a></td></tr>
<tr><td colspan="3"><hr></td></tr>
<tr><th id="Concept-index_cp_letter-P">P</th></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-parse-result">parse result</a></td><td class="printindex-index-section"><a href="#Introduction">Introduction</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-parse-result-1">parse result</a></td><td class="printindex-index-section"><a href="#Package-for-parse-result-construction-features">Package for parse result construction features</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-parse-result-2">parse result</a></td><td class="printindex-index-section"><a href="#Package-for-CST-features">Package for CST features</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-parse-result-3">parse result</a></td><td class="printindex-index-section"><a href="#Ordinary-reader-features">Ordinary reader features</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-parse-result-4">parse result</a></td><td class="printindex-index-section"><a href="#Parse-result-construction-features">Parse result construction features</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-parse-result-5">parse result</a></td><td class="printindex-index-section"><a href="#CST-reader-features">CST reader features</a></td></tr>
<tr><td colspan="3"><hr></td></tr>
<tr><th id="Concept-index_cp_letter-Q">Q</th></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-quasiquotation">quasiquotation</a></td><td class="printindex-index-section"><a href="#S_002dexpression-creation-and-quasiquotation">S-expression creation and quasiquotation</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-quasiquote">quasiquote</a></td><td class="printindex-index-section"><a href="#Interpretation-of-Backquote-and-Sharpsign-Single-Quote">Interpretation of Backquote and Sharpsign Single Quote</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-quotation">quotation</a></td><td class="printindex-index-section"><a href="#S_002dexpression-creation-and-quasiquotation">S-expression creation and quasiquotation</a></td></tr>
<tr><td colspan="3"><hr></td></tr>
<tr><th id="Concept-index_cp_letter-R">R</th></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-reader-macro">reader macro</a></td><td class="printindex-index-section"><a href="#Interpretation-of-Sharpsign-C-and-Sharpsign-S">Interpretation of Sharpsign C and Sharpsign S</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-reader-macro-1">reader macro</a></td><td class="printindex-index-section"><a href="#Interpretation-of-Backquote-and-Sharpsign-Single-Quote">Interpretation of Backquote and Sharpsign Single Quote</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-reader-state">reader state</a></td><td class="printindex-index-section"><a href="#Reader-state-protocol">Reader state protocol</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-readtable">readtable</a></td><td class="printindex-index-section"><a href="#Package-for-readtable-features">Package for readtable features</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-readtable-1">readtable</a></td><td class="printindex-index-section"><a href="#Readtable-initialization">Readtable initialization</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-readtable-2">readtable</a></td><td class="printindex-index-section"><a href="#Readtable-features">Readtable features</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-recovery">recovery</a></td><td class="printindex-index-section"><a href="#Recovering-from-errors">Recovering from errors</a></td></tr>
<tr><td colspan="3"><hr></td></tr>
<tr><th id="Concept-index_cp_letter-S">S</th></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-side-effects">side effects</a></td><td class="printindex-index-section"><a href="#Side-effects">Side effects</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-source-location">source location</a></td><td class="printindex-index-section"><a href="#Basic-features">Basic features</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-source-tracking">source tracking</a></td><td class="printindex-index-section"><a href="#Introduction">Introduction</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-source-tracking-1">source tracking</a></td><td class="printindex-index-section"><a href="#Ordinary-reader-features">Ordinary reader features</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-specification-interpretation">specification interpretation</a></td><td class="printindex-index-section"><a href="#Interpretation-of-unclear-parts-of-the-specification">Interpretation of unclear parts of the specification</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-structure-literal">structure literal</a></td><td class="printindex-index-section"><a href="#Interpretation-of-Sharpsign-C-and-Sharpsign-S">Interpretation of Sharpsign C and Sharpsign S</a></td></tr>
<tr><td colspan="3"><hr></td></tr>
</table>
<table class="cp-letters-footer-printindex"><tr><th>Jump to: &nbsp; </th><td><a class="summary-letter-printindex" href="#Concept-index_cp_letter-A"><b>A</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-index_cp_letter-C"><b>C</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-index_cp_letter-E"><b>E</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-index_cp_letter-F"><b>F</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-index_cp_letter-L"><b>L</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-index_cp_letter-P"><b>P</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-index_cp_letter-Q"><b>Q</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-index_cp_letter-R"><b>R</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-index_cp_letter-S"><b>S</b></a>
 &nbsp; 
</td></tr></table>
</div>

<hr>
</div>
<div class="unnumbered-level-extent" id="Function-and-macro-and-variable-and-type-index">
<h2 class="unnumbered" id="Function-and-macro-and-variable-and-type-index-1"><span>Function and macro and variable and type index<a class="copiable-link" href="#Function-and-macro-and-variable-and-type-index-1"> &para;</a></span></h2>

<div class="printindex fn-printindex">
<table class="fn-letters-header-printindex"><tr><th>Jump to: &nbsp; </th><td><a class="summary-letter-printindex" href="#Function-and-macro-and-variable-and-type-index_fn_symbol-1"><b>*</b></a>
 &nbsp; 
<br>
<a class="summary-letter-printindex" href="#Function-and-macro-and-variable-and-type-index_fn_letter-C"><b>C</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-macro-and-variable-and-type-index_fn_letter-E"><b>E</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-macro-and-variable-and-type-index_fn_letter-F"><b>F</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-macro-and-variable-and-type-index_fn_letter-I"><b>I</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-macro-and-variable-and-type-index_fn_letter-L"><b>L</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-macro-and-variable-and-type-index_fn_letter-M"><b>M</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-macro-and-variable-and-type-index_fn_letter-N"><b>N</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-macro-and-variable-and-type-index_fn_letter-P"><b>P</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-macro-and-variable-and-type-index_fn_letter-R"><b>R</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-macro-and-variable-and-type-index_fn_letter-S"><b>S</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-macro-and-variable-and-type-index_fn_letter-V"><b>V</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-macro-and-variable-and-type-index_fn_letter-W"><b>W</b></a>
 &nbsp; 
</td></tr></table>
<table class="fn-entries-printindex" border="0">
<tr><td></td><th class="entries-header-printindex">Index Entry</th><th class="sections-header-printindex">Section</th></tr>
<tr><td colspan="3"><hr></td></tr>
<tr><th id="Function-and-macro-and-variable-and-type-index_fn_symbol-1">*</th></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_002aclient_002a-_005beclector_002ebase_005d"><code>*client* [eclector.base]</code></a></td><td class="printindex-index-section"><a href="#Basic-features">Basic features</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_002askip_002dreason_002a-_005beclector_002ereader_005d"><code>*skip-reason* [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Reader-behavior-protocol">Reader behavior protocol</a></td></tr>
<tr><td colspan="3"><hr></td></tr>
<tr><th id="Function-and-macro-and-variable-and-type-index_fn_letter-C">C</th></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-call_002das_002dtop_002dlevel_002dread-_005beclector_002ereader_005d"><code>call-as-top-level-read [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Reader-behavior-protocol">Reader behavior protocol</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-call_002dreader_002dmacro-_005beclector_002ereader_005d"><code>call-reader-macro [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Reader-behavior-protocol">Reader behavior protocol</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-call_002dwith_002dcurrent_002dpackage-_005beclector_002ereader_005d"><code>call-with-current-package [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Reader-behavior-protocol">Reader behavior protocol</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-call_002dwith_002dlabel_002dtracking-_005beclector_002ereader_005d"><code>call-with-label-tracking [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Labeled-objects-and-references">Labeled objects and references</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-call_002dwith_002dstate_002dvalue-_005beclector_002ereader_005d"><code>call-with-state-value [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Reader-state-protocol">Reader state protocol</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-check_002dfeature_002dexpression-_005beclector_002ereader_005d"><code>check-feature-expression [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Reader-behavior-protocol">Reader behavior protocol</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-check_002dsymbol_002dtoken-_005beclector_002ereader_005d"><code>check-symbol-token [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Reader-behavior-protocol">Reader behavior protocol</a></td></tr>
<tr><td colspan="3"><hr></td></tr>
<tr><th id="Function-and-macro-and-variable-and-type-index_fn_letter-E">E</th></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-evaluate_002dexpression-_005beclector_002ereader_005d"><code>evaluate-expression [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Reader-behavior-protocol">Reader behavior protocol</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-evaluate_002dfeature_002dexpression-_005beclector_002ereader_005d"><code>evaluate-feature-expression [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Reader-behavior-protocol">Reader behavior protocol</a></td></tr>
<tr><td colspan="3"><hr></td></tr>
<tr><th id="Function-and-macro-and-variable-and-type-index_fn_letter-F">F</th></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-finalize_002dlabeled_002dobject-_005beclector_002ereader_005d"><code>finalize-labeled-object [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Labeled-objects-and-references">Labeled objects and references</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-find_002dcharacter-_005beclector_002ereader_005d"><code>find-character [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Reader-behavior-protocol">Reader behavior protocol</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-find_002dlabeled_002dobject-_005beclector_002ereader_005d"><code>find-labeled-object [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Labeled-objects-and-references">Labeled objects and references</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-fixup-_005beclector_002ereader_005d"><code>fixup [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Labeled-objects-and-references">Labeled objects and references</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-fixup_002dgraph-_005beclector_002ereader_005d"><code>fixup-graph [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Labeled-objects-and-references">Labeled objects and references</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-fixup_002dgraph_002dp-_005beclector_002ereader_005d"><code>fixup-graph-p [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Labeled-objects-and-references">Labeled objects and references</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-forget_002dlabeled_002dobject-_005beclector_002ereader_005d"><code>forget-labeled-object [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Labeled-objects-and-references">Labeled objects and references</a></td></tr>
<tr><td colspan="3"><hr></td></tr>
<tr><th id="Function-and-macro-and-variable-and-type-index_fn_letter-I">I</th></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-interpret_002dsymbol-_005beclector_002ereader_005d"><code>interpret-symbol [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Reader-behavior-protocol">Reader behavior protocol</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-interpret_002dsymbol_002dtoken-_005beclector_002ereader_005d"><code>interpret-symbol-token [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Reader-behavior-protocol">Reader behavior protocol</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-interpret_002dtoken-_005beclector_002ereader_005d"><code>interpret-token [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Reader-behavior-protocol">Reader behavior protocol</a></td></tr>
<tr><td colspan="3"><hr></td></tr>
<tr><th id="Function-and-macro-and-variable-and-type-index_fn_letter-L">L</th></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-labeled_002dobject_002dstate-_005beclector_002ereader_005d"><code>labeled-object-state [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Labeled-objects-and-references">Labeled objects and references</a></td></tr>
<tr><td colspan="3"><hr></td></tr>
<tr><th id="Function-and-macro-and-variable-and-type-index_fn_letter-M">M</th></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-make_002dexpression_002dresult-_005beclector_002eparse_002dresult_005d"><code>make-expression-result [eclector.parse-result]</code></a></td><td class="printindex-index-section"><a href="#Parse-result-construction-features">Parse result construction features</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-make_002dlabeled_002dobject-_005beclector_002ereader_005d"><code>make-labeled-object [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Labeled-objects-and-references">Labeled objects and references</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-make_002dskipped_002dinput_002dresult-_005beclector_002eparse_002dresult_005d"><code>make-skipped-input-result [eclector.parse-result]</code></a></td><td class="printindex-index-section"><a href="#Parse-result-construction-features">Parse result construction features</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-make_002dsource_002drange-_005beclector_002ebase_005d"><code>make-source-range [eclector.base]</code></a></td><td class="printindex-index-section"><a href="#Basic-features">Basic features</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-make_002dstructure_002dinstance-_005beclector_002ereader_005d"><code>make-structure-instance [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Reader-behavior-protocol">Reader behavior protocol</a></td></tr>
<tr><td colspan="3"><hr></td></tr>
<tr><th id="Function-and-macro-and-variable-and-type-index_fn_letter-N">N</th></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-note_002dlabeled_002dobject-_005beclector_002ereader_005d"><code>note-labeled-object [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Labeled-objects-and-references">Labeled objects and references</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-note_002dskipped_002dinput-_005beclector_002ereader_005d"><code>note-skipped-input [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Reader-behavior-protocol">Reader behavior protocol</a></td></tr>
<tr><td colspan="3"><hr></td></tr>
<tr><th id="Function-and-macro-and-variable-and-type-index_fn_letter-P">P</th></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-parse_002dresult_002dclient-_005beclector_002eparse_002dresult_005d"><code>parse-result-client [eclector.parse-result]</code></a></td><td class="printindex-index-section"><a href="#Parse-result-construction-features">Parse result construction features</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-position_002doffset-_005beclector_002ebase_005d"><code>position-offset [eclector.base]</code></a></td><td class="printindex-index-section"><a href="#Basic-features">Basic features</a></td></tr>
<tr><td colspan="3"><hr></td></tr>
<tr><th id="Function-and-macro-and-variable-and-type-index_fn_letter-R">R</th></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-range_002dlength-_005beclector_002ebase_005d"><code>range-length [eclector.base]</code></a></td><td class="printindex-index-section"><a href="#Basic-features">Basic features</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-read-_005beclector_002econcrete_002dsyntax_002dtree_005d"><code>read [eclector.concrete-syntax-tree]</code></a></td><td class="printindex-index-section"><a href="#CST-reader-features">CST reader features</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-read-_005beclector_002eparse_002dresult_005d"><code>read [eclector.parse-result]</code></a></td><td class="printindex-index-section"><a href="#Parse-result-construction-features">Parse result construction features</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-read-_005beclector_002ereader_005d"><code>read [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Common-Lisp-reader-compatible-interface">Common Lisp reader compatible interface</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-read_002dcommon-_005beclector_002ereader_005d"><code>read-common [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Reader-behavior-protocol">Reader behavior protocol</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-read_002ddelimited_002dlist-_005beclector_002ereader_005d"><code>read-delimited-list [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Common-Lisp-reader-compatible-interface">Common Lisp reader compatible interface</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-read_002dfrom_002dstring-_005beclector_002econcrete_002dsyntax_002dtree_005d"><code>read-from-string [eclector.concrete-syntax-tree]</code></a></td><td class="printindex-index-section"><a href="#CST-reader-features">CST reader features</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-read_002dfrom_002dstring-_005beclector_002eparse_002dresult_005d"><code>read-from-string [eclector.parse-result]</code></a></td><td class="printindex-index-section"><a href="#Parse-result-construction-features">Parse result construction features</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-read_002dfrom_002dstring-_005beclector_002ereader_005d"><code>read-from-string [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Common-Lisp-reader-compatible-interface">Common Lisp reader compatible interface</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-read_002dmaybe_002dnothing-_005beclector_002ereader_005d"><code>read-maybe-nothing [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Reader-behavior-protocol">Reader behavior protocol</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-read_002dpreserving_002dwhitespace-_005beclector_002econcrete_002dsyntax_002dtree_005d"><code>read-preserving-whitespace [eclector.concrete-syntax-tree]</code></a></td><td class="printindex-index-section"><a href="#CST-reader-features">CST reader features</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-read_002dpreserving_002dwhitespace-_005beclector_002eparse_002dresult_005d"><code>read-preserving-whitespace [eclector.parse-result]</code></a></td><td class="printindex-index-section"><a href="#Parse-result-construction-features">Parse result construction features</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-read_002dpreserving_002dwhitespace-_005beclector_002ereader_005d"><code>read-preserving-whitespace [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Common-Lisp-reader-compatible-interface">Common Lisp reader compatible interface</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-read_002dtoken-_005beclector_002ereader_005d"><code>read-token [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Reader-behavior-protocol">Reader behavior protocol</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-readtablep-_005beclector_002ereadtable_005d"><code>readtablep [eclector.readtable]</code></a></td><td class="printindex-index-section"><a href="#Readtable-features">Readtable features</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-recover-_005beclector_002ereader_005d"><code>recover [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Error-recovery-features">Error recovery features</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-reference_002dlabeled_002dobject-_005beclector_002ereader_005d"><code>reference-labeled-object [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Labeled-objects-and-references">Labeled objects and references</a></td></tr>
<tr><td colspan="3"><hr></td></tr>
<tr><th id="Function-and-macro-and-variable-and-type-index_fn_letter-S">S</th></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-set_002dstandard_002ddispatch_002dmacro_002dcharacters-_005beclector_002ereader_005d"><code>set-standard-dispatch-macro-characters [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Readtable-initialization">Readtable initialization</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-set_002dstandard_002dmacro_002dcharacters-_005beclector_002ereader_005d"><code>set-standard-macro-characters [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Readtable-initialization">Readtable initialization</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-set_002dstandard_002dsyntax_002dand_002dmacros-_005beclector_002ereader_005d"><code>set-standard-syntax-and-macros [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Readtable-initialization">Readtable initialization</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-set_002dstandard_002dsyntax_002dtypes-_005beclector_002ereader_005d"><code>set-standard-syntax-types [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Readtable-initialization">Readtable initialization</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-source_002dposition-_005beclector_002ebase_005d"><code>source-position [eclector.base]</code></a></td><td class="printindex-index-section"><a href="#Basic-features">Basic features</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-state_002dvalue-_005beclector_002ereader_005d"><code>state-value [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Reader-state-protocol">Reader state protocol</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-stream_002dposition-_005beclector_002ebase_005d"><code>stream-position [eclector.base]</code></a></td><td class="printindex-index-section"><a href="#Basic-features">Basic features</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-stream_002dposition_002dcondition-_005beclector_002ebase_005d"><code>stream-position-condition [eclector.base]</code></a></td><td class="printindex-index-section"><a href="#Basic-features">Basic features</a></td></tr>
<tr><td colspan="3"><hr></td></tr>
<tr><th id="Function-and-macro-and-variable-and-type-index_fn_letter-V">V</th></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-valid_002dstate_002dvalue_002dp-_005beclector_002ereader_005d"><code>valid-state-value-p [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#Reader-state-protocol">Reader state protocol</a></td></tr>
<tr><td colspan="3"><hr></td></tr>
<tr><th id="Function-and-macro-and-variable-and-type-index_fn_letter-W">W</th></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-with_002dforbidden_002dquasiquotation-_005beclector_002ereader_005d"><code>with-forbidden-quasiquotation [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#S_002dexpression-creation-and-quasiquotation">S-expression creation and quasiquotation</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-wrap_002din_002dfunction-_005beclector_002ereader_005d"><code>wrap-in-function [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#S_002dexpression-creation-and-quasiquotation">S-expression creation and quasiquotation</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-wrap_002din_002dquasiquote-_005beclector_002ereader_005d"><code>wrap-in-quasiquote [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#S_002dexpression-creation-and-quasiquotation">S-expression creation and quasiquotation</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-wrap_002din_002dquote-_005beclector_002ereader_005d"><code>wrap-in-quote [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#S_002dexpression-creation-and-quasiquotation">S-expression creation and quasiquotation</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-wrap_002din_002dunquote-_005beclector_002ereader_005d"><code>wrap-in-unquote [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#S_002dexpression-creation-and-quasiquotation">S-expression creation and quasiquotation</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-wrap_002din_002dunquote_002dsplicing-_005beclector_002ereader_005d"><code>wrap-in-unquote-splicing [eclector.reader]</code></a></td><td class="printindex-index-section"><a href="#S_002dexpression-creation-and-quasiquotation">S-expression creation and quasiquotation</a></td></tr>
<tr><td colspan="3"><hr></td></tr>
</table>
<table class="fn-letters-footer-printindex"><tr><th>Jump to: &nbsp; </th><td><a class="summary-letter-printindex" href="#Function-and-macro-and-variable-and-type-index_fn_symbol-1"><b>*</b></a>
 &nbsp; 
<br>
<a class="summary-letter-printindex" href="#Function-and-macro-and-variable-and-type-index_fn_letter-C"><b>C</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-macro-and-variable-and-type-index_fn_letter-E"><b>E</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-macro-and-variable-and-type-index_fn_letter-F"><b>F</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-macro-and-variable-and-type-index_fn_letter-I"><b>I</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-macro-and-variable-and-type-index_fn_letter-L"><b>L</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-macro-and-variable-and-type-index_fn_letter-M"><b>M</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-macro-and-variable-and-type-index_fn_letter-N"><b>N</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-macro-and-variable-and-type-index_fn_letter-P"><b>P</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-macro-and-variable-and-type-index_fn_letter-R"><b>R</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-macro-and-variable-and-type-index_fn_letter-S"><b>S</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-macro-and-variable-and-type-index_fn_letter-V"><b>V</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-macro-and-variable-and-type-index_fn_letter-W"><b>W</b></a>
 &nbsp; 
</td></tr></table>
</div>

<hr>
</div>
<div class="unnumbered-level-extent" id="Changelog">
<h2 class="unnumbered" id="Changelog-1"><span>Changelog<a class="copiable-link" href="#Changelog-1"> &para;</a></span></h2>

<dl class="table">
<dt>Release 0.10 (not yet released)</dt>
<dd>
<ul class="itemize mark-bullet">
<li>The deprecated generic functions <code class="t">eclector.parse-result:source-position</code> and
<code class="t">eclector.parse-result:make-source-range</code> have been removed. Clients should
use <code class="t">eclector.base:source-position</code> and <code class="t">eclector.base:make-source-range</code>
respectively instead.

</li><li>The new reader <code class="t">eclector.base:range-length</code> can be applied to conditions of
type <code class="t">eclector.base:stream-position-condition</code> (which includes almost all
conditions related to syntax errors) to determine the length of the
sub-sequence of the input to which the condition in question pertains.

</li><li>Minor incompatible change

<p>The part of the labeled objects protocol that allows clients to construct parse
results which represent labeled objects has been changed in an incompatible
way. The change allows parse results which represent labeled objects to have
child parse results but requires that clients construct parse results which
represent labeled objects differently: instead of eql-specializing the
<code class="t">result</code> parameters of methods on
<code class="t">eclector.parse-result:make-expression-result</code> to
<code class="t">eclector.parse-result:**definition**</code> and
<code class="t">eclector.parse-result:**reference**</code> and receiving the labeled object in the
<code class="t">children</code> parameters, the <code class="t">result</code> parameters now have to be specialized
to the classes <code class="t">eclector.parse-result:definition</code> and
<code class="t">eclector.parse-result:reference</code> respectively. The object passed as the
<code class="t">result</code> argument now contains the labeled object so that the <code class="t">children</code>
parameter can receive child parse results.
</p>
<p>This change is considered minor since the old mechanism described above was not
documented. For now, the new mechanism also remains undocumented so that the
design can be validated through experimentation before it is finalized.
</p>
</li><li>The new <code class="t">syntax-extensions</code> module contains a collection of syntax extensions
which are implemented as either mixin classes for clients or reader macro
functions.

</li><li>The extended package prefix extension allows prefixing an expression with a
package designator in order to read the expression with the designated package
as the current package. For example

<div class="example lisp">
<pre class="lisp-preformatted">my-package::(a b)
</pre></div>

<p>is read as
</p>
<div class="example lisp">
<pre class="lisp-preformatted">(my-package::a my-package::b)
</pre></div>

<p>with this extension.
</p>
</li><li>A new syntax extension which is implemented by the reader macro
<code class="t">eclector.syntax-extensions.s-expression-comment:s-expression-comment</code> allows
commenting out s-expressions in a fashion similar to SRFI 62 for scheme. One
difference is that a numeric infix argument can be used to comment out a number
of s-expressions different from 1:

<div class="example lisp">
<pre class="lisp-preformatted">(frob r1 r2 :k3 4 #4; :k5 6 :k6 7)
</pre></div>

</li></ul>
</dd>
<dt>Release 0.9 (2023-03-19)</dt>
<dd>
<ul class="itemize mark-bullet">
<li>The deprecated function <code class="t">eclector.concrete-syntax-tree:cst-read</code> has been
removed. Clients should use <code class="t">eclector.concrete-syntax-tree:read</code> instead.

</li><li><code class="t">eclector.reader:find-character</code> receives characters names with unmodified
case and is also called in the <code class="t">#\&lt;single character&gt;</code> case so that clients
have more control over character lookup.

</li><li>The new generic function <code class="t">eclector.base:position-offset</code> allows interested
clients to refine the source positions of errors obtained by calling
<code class="t">eclector.base:stream-position</code>.

</li><li>Some condition and restart reports have been improved.

</li><li>A discussion of the relation between circular objects and custom reader macros
has been added to the manual (See <a class="xref" href="#Circular-objects-and-custom-reader-macros">Circular objects and custom reader macros</a>).

</li><li>Problems in the <code class="t">eclector.reader:fixup</code> method for hash tables have been
fixed: keys were not checked for circular structure and circular structures in
values were not fixed up in some cases.

</li><li>Eclector provides a new protocol for handling labeled objects, that is the
objects defined and referenced by the <code class="t">#=</code> and <code class="t">##</code> reader macros
respectively (See <a class="xref" href="#Labeled-objects-and-references">Labeled objects and references</a>).

</li><li>Eclector now avoids unnecessary fixup processing in object graphs with
complicated definitions and references.

<p>Before this change, cases like
</p>
<div class="example lisp">
<pre class="lisp-preformatted">#1=(1 #1# #2=(2 #2# ... #100=(100 #100#)))
</pre></div>

<p>or
</p>
<div class="example lisp">
<pre class="lisp-preformatted">#1=(1 #2=(2 ... #2#) ... #1#)
</pre></div>

<p>led to unnecessary and/or repeated traversals during fixup processing.
</p>
</li><li>Fixup processing is now performed in parse result objects.

<p>Before this change, something like
</p>
<div class="example lisp">
<pre class="lisp-preformatted">(eclector.concrete-syntax-tree:read-from-string &quot;#1=(#1#)&quot;)
</pre></div>

<p>produced a CST object, say <code class="t">cst</code>, which failed to satisfy
</p>
<div class="example lisp">
<pre class="lisp-preformatted">(eq (cst:first cst)       cst)
(eq (cst:raw (first cst)) (cst:raw cst))
</pre></div>

<p>The properties now hold.
</p>
</li><li>Clients can use the new mixin classes
<code class="t">eclector.concrete-syntax-tree:definition-csts-mixin</code> and
<code class="t">eclector.concrete-syntax-tree:reference-csts-mixin</code> to represent labeled
object definitions and references as instances of
<code class="t">eclector.concrete-syntax-tree:definition-cst</code> and
<code class="t">eclector.concrete-syntax-tree:reference-cst</code> respectively.

</li><li>The stream position in conditions signaled by
<code class="t">eclector.reader::sharpsign-colon</code> is now always present.

</li><li>When Eclector is used to produce parse results, it no longer confuses
end-of-input with having read <code class="t">nil</code> when <code class="t">nil</code> is used as the <code class="t">eof-value</code>
(<code class="t">nil</code> makes sense as an <code class="t">eof-value</code> in that case since <code class="t">nil</code> is
generally not a possible parse result).

</li><li>A detailed description of the constraints on return values of the generic
functions in the Reader behavior protocol has been added to the manual
(See <a class="xref" href="#Reader-behavior-protocol">Reader behavior protocol</a>).

</li><li>The <code class="t">eclector-concrete-syntax-tree</code> system now works with and requires
version 0.2 of the <code class="t">concrete-syntax-tree</code> system.

</li><li>Eclector provides a new protocol for querying and binding behavior-changing
aspects of the current state of the reader such as the current package, the
current readtable and the current read base (See <a class="xref" href="#Reader-state-protocol">Reader state protocol</a>).

<p>Clients can use this protocol to control the reader state in other ways than
binding the Common Lisp variables, for example by storing the values of reader
state aspects in context objects.
</p>
<p>Furthermore, implementations which use Eclector as the Common Lisp reader can
use this protocol to tie the <code class="t">cl:*readtable*</code> aspect to the
<code class="t">cl:*readtable*</code> variable instead of the <code class="t">eclector.reader:*readtable*</code>
variable.
</p>
<p>The new protocol subsumes the purpose of the generic function
<code class="t">eclector.reader:call-with-current-package</code> which is deprecated as of this
Eclector version.
</p>
</li><li>Eclector now provides and uses by default a relaxed version of the
<code class="t">eclector.reader::sharpsign-s</code> reader macro function which requires the input
following <code class="t">#S</code> to be read as a list but not necessarily be literally written
as <code class="t">(TYPE INITARG₁ VALUE₁ …)</code>.

<p>A detailed discussion of the topic has been added to the manual
(See <a class="xref" href="#Interpretation-of-Sharpsign-C-and-Sharpsign-S">Interpretation of Sharpsign C and Sharpsign S</a>).
</p>
</li></ul>
</dd>
<dt>Release 0.8 (2021-08-24)</dt>
<dd>
<ul class="itemize mark-bullet">
<li>The default <code class="t">eclector.reader:read-token</code> method and the functions
<code class="t">eclector.reader::sharpsign-colon</code> and
<code class="t">eclector.reader::sharpsign-backslash</code> are now more efficient as well as less
redundant in terms of repeated code.

</li><li>The feature <code class="t">:eclector-define-cl-variables</code> now controls whether the file
<code class="t">code/reader/variables.lisp</code> is loaded and thus whether the variables
<code class="t">eclector.reader:*package*</code>, <code class="t">eclector.reader:*read-eval*</code>, etc. are
defined.

</li></ul>
</dd>
<dt>Release 0.7 (2021-05-16)</dt>
<dd>
<ul class="itemize mark-bullet">
<li>The incorrectly committed generic function
<code class="t">eclector.reader:check-symbol-token</code> has been fixed.

</li><li>Empty escape ranges like <code class="t">||</code> are no longer interpreted as potential numbers.

</li><li>The default <code class="t">eclector.reader:interpret-symbol</code> method now signals specific
conditions and offers restarts for recovering from situations related to
non-existent packages and symbols as well as non-exported symbols.

<p>The default error recovery strategy for invalid symbols now constructs an
uninterned symbol of the given name instead of using <code class="t">nil</code>.
</p>
</li><li>The &quot;consing dot&quot; is no longer accepted in sub-expressions of
<code class="t">eclector.reader::left-parenthesis</code>.

<p>At the same time, it is now possible to recover from encountering the
&quot;consing dot&quot; in invalid positions.
</p>
</li><li>The default <code class="t">eclector.reader:interpret-token</code> method has been optimized
substantially.

</li><li>The <code class="t">eclector.reader:*client*</code> variable and the source location protocol
(that is the generic functions <code class="t">eclector.parse-result:source-position</code> and
<code class="t">eclector.parse-result:make-source-range</code>) have been moved to a new <code class="t">base</code>
module and package <code class="t">eclector.base</code> which the <code class="t">reader</code> module and the
<code class="t">eclector.reader</code> package can use. This structure allows code in the
<code class="t">reader</code> module to work with source locations.

<p>The name <code class="t">eclector.base:*client*</code> remains exported as
<code class="t">eclector.reader:*client*</code>.
</p>
<p>The old names <code class="t">eclector.parse-result:source-position</code> and
<code class="t">eclector.parse-result:make-source-range</code> still exist but are now deprecated
and will be removed in a future release.
</p>
</li><li>Conditions signaled by code in the <code class="t">reader</code> module now include source
positions which are obtained by calling <code class="t">eclector.base:source-position</code>.

</li></ul>
</dd>
<dt>Release 0.6 (2020-11-29)</dt>
<dd>
<ul class="itemize mark-bullet">
<li>Bogus <code class="t">nil</code> parse results are no longer generated by
<code class="t">eclector.parse-result:make-skipped-input-result</code> calls when
<code class="t">cl:*read-suppress*</code> is true.

</li><li>The new generic functions <code class="t">eclector.reader:read-maybe-nothing</code> and
<code class="t">eclector.reader:call-as-top-level-read</code> give clients additional entry points
to the reader as well as customization possibilities. With these functions, the
chain of functions calls for a <code class="t">read</code> call looks like this:

<div class="example">
<pre class="example-preformatted">eclector.reader:read
  eclector.reader:call-as-top-level-read
    eclector.reader:read-common
      eclector.reader:read-maybe-nothing
        ...
          eclector.reader:read-char
          eclector.reader:peek-char
</pre></div>

<p>Diagrams which illustrate the relations between the new and existing functions
have been added to the manual (<a class="ref" href="#fig_003aread_002dcall_002dsequence_002dordinary">Figure 2.1</a>,
<a class="ref" href="#fig_003aread_002dcall_002dsequence_002dcustomization">Figure 2.2</a>,
<a class="ref" href="#fig_003aread_002dcall_002dsequence_002dparse_002dresult">Figure 2.5</a>).
</p>
</li><li>The function <code class="t">eclector.reader::read-rational</code> now better respects the value
of <code class="t">*read-suppress*</code>.

</li><li>Fix return value of <code class="t">eclector.readtable:set-syntax-from-char</code>, fix
<code class="t">(setf eclector.readtable:syntax-from-char)</code> to also copy the macro character
information.

</li><li>The semicolon reader macro now consumes the terminating newline character.

</li><li>Eclector now provides the generic function <code class="t">eclector.reader:wrap-in-function</code>.

</li><li>Reset <code class="t">eclector.reader::*list-reader*</code> around recursive read in
<code class="t">eclector.reader::sharpsign-dot</code>.

</li><li>Implement and default to relaxed syntax for <code class="t">eclector.reader::sharpsign-c</code>.
The strict version is still available as <code class="t">eclector.reader:strict-sharpsign-c</code>
and can be installed into a custom readtable.

<p>A detailed discussion of the topic has been added to the manual
(See <a class="xref" href="#Interpretation-of-Sharpsign-C-and-Sharpsign-S">Interpretation of Sharpsign C and Sharpsign S</a>).
</p>
</li><li>Eclector can now recover from reading invalid inputs like <code class="t">..</code> and <code class="t">...</code>.

</li><li>Implement and default to relaxed syntax for
<code class="t">eclector.reader::sharpsign-single-quote</code>. The strict version is still
available as <code class="t">eclector.reader:strict-sharpsign-single-quote</code> and can be
installed into a custom readtable.

<p>A detailed discussion of the topic has been added to the manual
(See <a class="xref" href="#Interpretation-of-Backquote-and-Sharpsign-Single-Quote">Interpretation of Backquote and Sharpsign Single Quote</a>).
</p>
</li><li>Eclector now provides the generic function
<code class="t">eclector.reader:check-symbol-token</code>.

</li><li>Input of the form <code class="t">PACKAGE::||</code> is now correctly read as a symbol.

</li><li>Eclector can now recover from reading the invalid input <code class="t">:</code>.

</li></ul>
</dd>
<dt>Release 0.5 (2020-06-09)</dt>
<dd>
<ul class="itemize mark-bullet">
<li>The generic function <code class="t">eclector.reader:call-with-current-package</code> has been
added.

</li><li>The previously missing functions
<code class="t">eclector.parse-result:read-preserving-whitespace</code> and
<code class="t">eclector.parse-result:read-from-string</code> have been added.

</li><li>The previously missing functions
<code class="t">eclector.concrete-syntax-tree:read-preserving-whitespace</code> and
<code class="t">eclector.concrete-syntax-tree:read-from-string</code> have been added.

</li><li>The function <code class="t">eclector.concrete-syntax-tree:cst-read</code> has been renamed to
<code class="t">eclector.concrete-syntax-tree:read</code>.
<code class="t">eclector.concrete-syntax-tree:cst-read</code> still exists but is deprecated and
will be removed in a future version.

</li><li>Quasiquote and unquote are now opt-out instead of opt-in. This allows
quasiquotation in custom reader macros by default. The new macro
<code class="t">eclector.reader::with-forbidden-quasiquotation</code> is used by Eclector (and can
be used in custom reader macros) to control this behavior.

</li><li>A method on <code class="t">eclector.readtable:readtablep</code> for the simple readtable
implementation has been added.

</li><li>The condition type <code class="t">eclector.base:end-of-file</code> is now a subtype of
<code class="t">cl:stream-error</code> but not of <code class="t">cl:reader-error</code>.

</li><li>An error is now always signaled independently of the the value of the
<code class="t">eof-error</code> parameter when the end of input is encountered a after single
escape or within a multiple escape. The new error conditions
<code class="t">eclector.reader:unterminated-single-escape</code> and
<code class="t">eclector.reader:unterminated-multiple-escape</code> are signaled in such
situations.

</li><li>The set invalid sub-characters for <code class="t">#</code> now conforms to the specification.

</li><li>The value of <code class="t">cl:*read-base*</code> is now used correctly when distinguishing
numbers and symbols.

</li><li>When a number with a denominator of zero is read the new condition
<code class="t">eclector.reader:zero-denominator</code> is signaled.

</li><li>The function <code class="t">eclector.reader:read-delimited-list</code> has been added.

</li><li>The reader macro function <code class="t">eclector.reader::sharpsign-s</code> now accepts string
designators as slot names.

</li><li>The reader macro functions <code class="t">eclector.reader::sharpsign-equals</code> and
<code class="t">eclector.reader::sharpsign-sharpsign</code> respect the value of
<code class="t">cl:*read-suppress*</code>.

</li><li>The default methods on the generic function <code class="t">eclector.reader:fixup</code> now works
correctly for <code class="t">standard-object</code> instances with unbound slots.

</li><li>The reader macro function <code class="t">eclector.reader::left-parenthesis</code> now always
reads until <code class="t">#\)</code>, not some &quot;opposite&quot; character.

</li><li><code class="t">eclector.reader:*skip-reason*</code> is now set correctly when a line comment at
the end of input is read.

</li><li>In almost all situations in which Eclector signals a syntax error, a restart
named <code class="t">eclector.reader:recover</code> is now established which, when invoked
performs some action which allows the remainder of the expression to be read.
The convenience function <code class="t">eclector.reader:recover</code> can be used to invoke the
restart.

</li></ul>
</dd>
<dt>Release 0.4 (2019-05-11)</dt>
<dd>
<ul class="itemize mark-bullet">
<li>The reader macro function <code class="t">eclector.reader::sharpsign-plus-minus</code> now sets
<code class="t">eclector.reader:*skip-reason*</code> so that parse results can be created with an
accurate &quot;reason&quot; value.

</li><li>Constituent traits are now represented and used properly.

</li><li>The lambda lists of the functions <code class="t">eclector.reader:read-char</code> and
<code class="t">eclector.reader:peek-char</code> have been fixed.

</li><li>The function <code class="t">eclector.reader::read-rational</code> now respects
<code class="t">cl:*read-suppress*</code> and handles inputs of the form <code class="t">1 2</code> correctly.

</li><li>The reader macro function <code class="t">eclector.reader::sharpsign-r</code> now handles
<code class="t">cl:*read-suppress*</code> better.

</li><li>The default method on the generic function <code class="t">eclector.reader:interpret-token</code>
now distinguishes positive and negative float zeros and uses radix 10 instead
of the value of <code class="t">cl:*read-base*</code> for float digits.

</li><li>The input <code class="t">.||</code> is now interpreted as a symbol instead of the &quot;consing dot&quot;.

</li><li>Long lists are now read into concrete syntax tree results without relying on
unbounded recursion.

</li><li>Syntax errors in the initial contents part of <code class="t">#A</code> expressions now signal
appropriate errors.

</li><li>Source ranges of parse results no longer include whitespace which followed the
corresponding expression in the input.

</li><li>The lambda list of the function <code class="t">eclector.parse-result:read</code> is now accurate.

</li></ul>
</dd>
<dt>Release 0.3 (2018-11-28)</dt>
<dd>
<ul class="itemize mark-bullet">
<li>The function <code class="t">eclector.reader:peek-char</code> has been added. The new function is
like <code class="t">cl:peek-char</code> but signals Eclector conditions and uses the Eclector
readtable.

</li><li>The function <code class="t">eclector.reader:read-from-string</code> has been added. The new
function is like <code class="t">cl:read-from-string</code> but uses Eclector&rsquo;s reader
implementation.

</li><li>The reader macro function <code class="t">eclector.reader::sharpsign-s</code> and the generic
function <code class="t">eclector.reader:make-structure-instance</code> have been added. Eclector
does not define any methods on the latter generic function since there is no
portable way of creating a structure instance when only the symbol naming the
structure is known.

</li><li>The generic function <code class="t">eclector.reader:interpret-symbol</code> is now called when
the reader creates uninterned symbols.

</li><li>The generic function <code class="t">eclector.reader:fixup</code> now accepts a client object as
the the argument.

</li><li>In the generic functions <code class="t">eclector.reader:wrap-in-quasiquote</code>,
<code class="t">eclector.reader:wrap-in-unquote</code> and
<code class="t">eclector.reader:wrap-in-unquote-splicing</code>, the client parameter is now the
first parameter.

</li><li>The generic function <code class="t">eclector.reader:wrap-in-quote</code> has been added.

</li></ul>
</dd>
<dt>Release 0.2 (2018-08-13)</dt>
<dd>
<ul class="itemize mark-bullet">
<li>The <code class="t">concrete-syntax-tree</code> module has been generalized into a
<code class="t">parse-result</code> module which provides a protocol for constructing arbitrary
custom parse results. The <code class="t">concrete-syntax-tree</code> module is now based on this
new module but can be used as before by clients.

</li><li>The default value of the <code class="t">eof-error-p</code> parameter of the
<code class="t">eclector.reader:read-char</code> function is now true.

</li></ul>
</dd>
<dt>Release 0.1 (2018-08-10)</dt>
<dd>
<ul class="itemize mark-bullet">
<li>Eclector was created by extracting the reader module from the SICL repository.

</li><li>The initial release includes many improvements over the original SICL reader,
particularly in the areas of customizability, error reporting and constructing
parse results.

</li></ul>
</dd>
</dl>

</div>
</div>
<div class="footnotes-segment">
<hr>
<h4 class="footnotes-heading">Footnotes</h4>

<h5 class="footnote-body-heading"><a id="FOOT1" href="#DOCF1">(1)</a></h5>
<p>See: <a class="url" href="https://github.com/s-expressionists/Concrete-Syntax-Tree">https://github.com/s-expressionists/Concrete-Syntax-Tree</a></p>
<h5 class="footnote-body-heading"><a id="FOOT2" href="#DOCF2">(2)</a></h5>
<p>Reader macro functions which call
<code class="t">eclector.reader:read</code> may receive labeled objects under certain
circumstances (see <a class="pxref" href="#Circular-objects-and-custom-reader-macros">Circular objects and custom reader macros</a>).</p>
<h5 class="footnote-body-heading"><a id="FOOT3" href="#DOCF3">(3)</a></h5>
<p>This fixup processing has to be delayed under certain
circumstances (see <a class="pxref" href="#Circular-objects-and-custom-reader-macros">Circular objects and custom reader macros</a>).</p>
<h5 class="footnote-body-heading"><a id="FOOT4" href="#DOCF4">(4)</a></h5>
<p>We use &ldquo;implementation-dependent&rdquo;
in the sense defined in the Common Lisp specification except that
Eclector is the implementation in question.</p>
</div>



</body>
</html>
